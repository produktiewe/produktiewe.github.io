window.addEventListener("load",function(){var S=function(){return parseInt(Date.now()+10*Math.random()+1)},N=function(a){a/=1E3;var c=parseInt(a/60/60),b=parseInt(a/60%60);a=parseInt(a%60);return{hour:c,minute:b,second:a}},T=function(a,c){var b=c-a;console.assert(0<=b,b);return N(b)},y=function(a){a=a.toString();return 1===a.length?"0"+a:a},z=function(a){return JSON.parse(JSON.stringify(a))},l=null,v={},w={},O={1:{id:1,title:"Todo",createdDate:Date.now(),tasks:[]}},U={1:{id:1,title:"General Board",
createdDate:Date.now(),panels:[1]}},K={modelSettings:{id:"modelSettings",modifiedModel:null,lastModified:Date.now()},timerSettings:{id:"timerSettings",timeLogId:null,taskId:null}},h=document.getElementsByClassName("content-body")[0],ca=h.getElementsByClassName("template-board")[0],da=h.getElementsByClassName("template-panel")[0],ea=h.getElementsByClassName("template-task")[0],fa=h.getElementsByClassName("template-sub-task")[0],ha=h.getElementsByClassName("template-timer")[0],ia=h.getElementsByClassName("template-timelog-panel")[0],
ja=h.getElementsByClassName("template-timelog-session-day")[0],ka=h.getElementsByClassName("template-timelog-session-hour")[0];h.removeChild(ca);h.removeChild(da);h.removeChild(ea);h.removeChild(fa);h.removeChild(ha);h.removeChild(ia);h.removeChild(ja);h.removeChild(ka);var L=Object.freeze({task:"task",subTask:"sub-task"}),H=Object.freeze({timerSettingsId:"timerSettings",modelSettingsId:"modelSettings"}),k=Object.freeze({taskStorageId:"task.json",timelogStorageId:"timelog.json",settingStorageId:"setting.json",
boardStorageId:"board.json",panelStorageId:"panel.json"}),p=Object.freeze({OnAll:"all",OnEdit:"edit",OnRemove:"remove",OnAdd:"add"}),W=function(){var a=null,c=function(){return utils.parseQueryString(window.location.hash).access_token},b=function(a){null==l&&(l={},l["task.json"]={data:{filename:"task.json",content:w}},l["timelog.json"]={data:{filename:"timelog.json",content:v}},l["setting.json"]={data:{filename:"setting.json",content:K}},l["board.json"]={data:{filename:"board.json",content:U}},l["panel.json"]=
{data:{filename:"panel.json",content:O}},h(0,function(c){m.ToggleSnack("Dropbox initialized!");a&&a(!0)}))},d=function(a,c,b){console.assert(a);console.assert(a instanceof Array);if(c<a.length){var f=a[c];g(a[c].name,function(e){e?(console.log(e),null==l&&(l={}),l[e.filename]={data:e,meta:f},"task.json"===e.filename?w=e.content:"timelog.json"===e.filename?v=e.content:"setting.json"===e.filename?K=e.content:"board.json"===e.filename?U=e.content:"panel.json"===e.filename?O=e.content:console.assert(!1,
"Never seen this file before!")):console.log("read failed! -> ",item.name);d(a,c+1,b)})}else b&&b(!0)},f=function(a,c){console.assert(a);var b=[],d=a.length;0<d?a.forEach(function(a){b.push(a);--d;0==d&&c&&c(b)}):c&&c(b)},e=function(c){a.filesListFolder({path:""}).then(function(a){f(a.entries,function(a){console.assert(a);console.assert(a instanceof Array);for(var e=document.getElementById("files"),f=0;f<a.length;f++){var V=a[f].name,q=document.createElement("li");q.innerHTML=V;e.appendChild(q)}0===
a.length?b(c):d(a,0,c)})})["catch"](function(a){console.error(a);c&&c(!1)})},g=function(a,b){var d='{"path": "/'+a+'"}';$.ajax({url:"https://content.dropboxapi.com/2/files/download",type:"POST",dataType:"json",headers:{Authorization:"Bearer "+c(),"Dropbox-API-Arg":d}}).done(function(a){b&&b(a)}).fail(function(a){console.log("error",a);b&&b(null)})},r=function(c,b,d){console.assert(-1<Object.values(k).indexOf(c));var e="/"+c,f=JSON.stringify(b);a.filesUpload({path:e,contents:f,mode:"overwrite"}).then(function(a){console.log(a);
d&&d(a)})["catch"](function(a){console.log(a);console.log("retrying.......");setTimeout(function(){r(c,b,d)},2E3)})},I=function(a,c){var b=!0;null==l?b=!1:Object.values(l).length!=Object.values(k).length&&(b=!1);1==b?r(a,l[a].data,function(b){l[a].meta=b;c&&c(!0)}):c&&c(!1)},h=function(a,c){var b=Object.values(k).sort(),d=b[a];a<b.length?(a+=1,I(d,function(b){b?console.log("remote file updated successfully --\x3e",d):console.log("remote update failed --\x3e",d);h(a,c)})):c&&c()},t=function(c,b,e){var f=
Object.values(k).sort(),g=f[c];c<f.length?a.filesGetMetadata({path:"/"+g}).then(function(a){(new Date(l[g].meta.server_modified)).valueOf()!=(new Date(a.server_modified)).valueOf()?d([a],0,function(a){a?(console.log("Sync with Remote Db ->",g),m.ToggleSnack("Sync with Remote Database"),b=!0):(console.log("Sync with Remote Db Failed! ->",g),m.ToggleSnack("Sync with Remote Failed!"));t(c+1,b,e)}):t(c+1,b,e)})["catch"](function(a){console.log(a);console.log("retrying....");setTimeout(function(){t(c,
b,e)},1E3)}):e&&e(b)};return{AuthenticateAndInitDb:function(b){if(c())document.getElementById("authed-section").style.display="block",a=new Dropbox.Dropbox({accessToken:c()}),e(function(a){a?(m.ToggleSnack("Local database updated!"),b&&b(!0)):(m.ToggleSnack("Local database update failed!"),b&&b(!1))});else{document.getElementById("pre-auth-section").style.display="block";a=new Dropbox.Dropbox({clientId:"1xc4d9cf123830a"});var d=a.getAuthenticationUrl("https://produktiewe.github.io/");document.getElementById("authlink").href=
d;b&&b(!1)}},UpdateRemoteStorage:I,UpdateChangedFiles:t}}(),F=function(){var a=null,c=null,b=null,d=null,f=null,e=0,g=function(a,b){b===p.OnEdit&&a.id===c.id&&J(a.timelog,E,0,function(b){console.log("timerstate updated");c=a;d=b;e=P(b)})},r=function(a){M(H.timerSettingsId,function(b){b||console.log("no timer settings found!");a&&a(b)})},I=function(){if(a&&c&&b&&f&&d){var g=b.getElementsByClassName("timer-task-title")[0],r=b.getElementsByClassName("timer-task-session-time")[0],h=b.getElementsByClassName("timer-task-total-time")[0],
k=Date.now(),t=a.startTimeStamp,n=T(t,k);k=N(e+(k-t));g.innerText=c.title;r.innerText=n.hour.toString()+":"+n.minute.toString()+":"+n.second.toString();h.innerText=k.hour.toString()+":"+k.minute.toString()+":"+k.second.toString();setTimeout(I,200)}},x=function(r,q){console.assert(r);console.assert(q);console.assert(null===a);console.assert(null===c);console.assert(null===d);console.assert(null===f);var V=q.id;A(H.timerSettingsId,"taskId",r.id,M,Q,function(f){f?(console.log("taskId added to app settings successfully"),
A(H.timerSettingsId,"timeLogId",V,M,Q,function(f){f?(console.log("timeLogId added to app settings successfully"),J(r.timelog,E,0,function(f){b=xa(r);a=q;c=r;d=f;e=P(f);m.ToggleSnack("Timer started - "+r.title);h.appendChild(b);setTimeout(I,200)})):(m.ToggleSnack("Timer start failed: 0"),console.log("timeLogId added to app settings failed!"),n())})):(m.ToggleSnack("Timer start failed: 1"),console.log("taskId added to app settings failed!"),n())});f=ya(k.taskStorageId,p.OnAll,g)},t=function(){var b=
Date.now();clearTimeout(I);m.ToggleSnack("Timer stopped for - "+c.title);A(a.id,"endTimeStamp",b,E,za,function(a){a?(console.log("set endTimeStamp success!"),n(),B()):console.log("set endTimeStamp faield!")})},n=function(){A(H.timerSettingsId,"timeLogId",null,M,Q,function(a){a?console.log("timeLogId - cleaned sucess!"):console.log("timeLogId - cleaned failed!")});A(H.timerSettingsId,"taskId",null,M,Q,function(a){a?console.log("taskId - cleaned sucess!"):console.log("taskId - cleaned failed!")});f&&
(Aa(k.taskStorageId,f),f=null);b&&h.contains(b)&&h.removeChild(b);d=b=c=a=null;e=0};return{InitTimer:function(){b&&h.removeChild(b);r(function(a){a?a.taskId&&a.timeLogId?la([a.taskId,a.timeLogId],[u,E],null,0,function(a){var b=a[0];a=a[1];b&&a?x(b,a):n()}):(a.taskId||a.timeLogId)&&n():console.log("error timerSettings not found!")})},StartTimer:function(a,b){x(a,b)},StopTimer:function(){t()},IsRunning:function(a){r(function(b){b?a&&a(b.timeLogId&&b.taskId):a&&a(!1)})}}}(),G=Object.freeze(function(){var a=
{};a[k.taskStorageId]=[];a[k.timelogStorageId]=[];a[k.settingStorageId]=[];a[k.boardStorageId]=[];a[k.panelStorageId]=[];return a}()),Aa=function(a,c){console.assert(G);console.assert(-1<Object.values(k).indexOf(a));var b=G[a];console.assert(b instanceof Array);for(var d=0;d<b.length;)c===b[d].id?(b.splice(d,1),d=0):d+=1},ya=function(a,c,b){console.assert(G);console.assert(-1<Object.values(k).indexOf(a));console.assert(-1<Object.values(p).indexOf(c));console.assert("function"===typeof b);var d=S();
G[a].push({id:d,eventType:c,remoteStorageId:a,cb:b});return d},C=function(a,c,b){console.assert(G);console.assert(-1<Object.values(k).indexOf(a));console.assert(-1<Object.values(p).indexOf(c));W.UpdateRemoteStorage(a,function(b){b?(m.ToggleSnack("Remote storage updated"),console.log("remote storage updated --\x3e",a)):(m.ToggleSnack("Remote storage update failed!"),console.log("remote storage update failed! --\x3e",a))});setTimeout(function(){console.assert(G);console.assert(-1<Object.values(k).indexOf(a));
console.assert(-1<Object.values(p).indexOf(c));var d=G[a];console.assert(d instanceof Array);for(var f=0;f<d.length;f++){var e=d[f];e.eventType!==c&&e.eventType!==p.OnAll||e.cb(b,c)}},2)},J=function(a,c,b,d,f){console.assert(Number.isInteger(b));console.assert(a instanceof Array);console.assert("function"===typeof c);f instanceof Array||(f=[]);b<a.length?c(a[b],function(e){f.push(e);b+=1;J(a,c,b,d,f)}):d&&d(f)},la=function(a,c,b,d,f){console.assert(Number.isInteger(d));console.assert(a instanceof
Array);console.assert(c instanceof Array);console.assert(a.length==c.length);b instanceof Array||(b=[]);if(d<a.length)(0,c[d])(a[d],function(e){b.push(e);d+=1;la(a,c,b,d,f)});else f(b)},ma=function(a,c){console.assert(a instanceof Array);console.assert("function"===typeof c);for(var b=0;b<a.length;b++)c(a[b])},X=function(a,c,b,d,f,e){console.assert("string"===typeof c);console.assert("function"===typeof d);console.assert("function"===typeof f);d(a,function(a){if(a){console.assert(a[c]instanceof Array);
var d=a[c],g=d.indexOf(b);-1<g&&d.splice(g,1);f(a,function(a){e&&e(a)})}else e&&e(!1)})},Y=function(a,c,b,d,f,e){console.assert("string"===typeof c);console.assert("function"===typeof d);console.assert("function"===typeof f);d(a,function(a){a?(console.assert(a[c]instanceof Array),a[c].push(b),f(a,function(a){e&&e(a)})):e&&e(!1)})},A=function(a,c,b,d,f,e){console.assert("string"===typeof c);console.assert("function"===typeof d);console.assert("function"===typeof f);d(a,function(a){a?(console.assert(c in
a),a[c]=b,f(a,function(a){e&&e(a)})):e&&e(!1)})},M=function(a,c){console.assert(-1<Object.values(H).indexOf(a));var b=z(K[a]);c&&c(b)},Q=function(a,c){K[a.id]=z(a);c&&c(!0);C(k.settingStorageId,p.OnEdit,K[a.id])},Ba=function(a,c){var b=z(U[a]);c&&c(b)},u=function(a,c){var b=z(w[a]);c&&c(b)},Z=function(a,c){u(a,function(b){b.type===L.task&&(ma(b.timelog,na),ma(b.subtasks,Z));delete w[a];c&&c(!0);C(k.taskStorageId,p.OnRemove,!0)})},D=function(a,c){null===a.doneDate&&1==a.done?a.doneDate=Date.now():
(a.doneDate=null,a.done=!1);w[a.id]=z(a);c&&c(!0);C(k.taskStorageId,p.OnEdit,w[a.id])},Ca=function(a,c){oa(a,L.subTask,function(a){c&&c(a)})},Da=function(a,c){oa(a,L.task,function(a){c&&c(a)})},oa=function(a,c,b){console.assert(-1<Object.values(L).indexOf(c));console.assert(a);var d=S();a={id:d,title:a,done:!1,doneDate:null,type:c,createdDate:Date.now(),timelog:[],subtasks:[]};c==L.subTask&&delete a.subtasks;w[d]=a;b&&b(w[d]);C(k.taskStorageId,p.OnAdd,w[d])},E=function(a,c){var b=z(v[a]);c&&c(b)},
na=function(a,c){delete v[a];c&&c(!0);C(k.timelogStorageId,p.OnRemove,!0)},za=function(a,c){var b=a.startTimeStamp,d=a.endTimeStamp;d&&b&&(a.duration=T(b,d));v[a.id]=z(a);c&&c(!0);C(k.timelogStorageId,p.OnEdit,v[a.id])},Ea=function(a,c,b){var d=S(),f=null;b&&(f=b);v[d]={id:d,startTimeStamp:a,endTimeStamp:f,duration:null};c&&c(v[d]);C(k.timelogStorageId,p.OnAdd,v[d])},Fa=function(a){var c={},b=[];a.sort(function(a,b){return b.startTimeStamp-a.startTimeStamp});for(var d=0;d<a.length;++d){var f=a[d],
e=(new Date(Date.now())).toDateString(),g=(new Date(f.startTimeStamp)).toDateString();e=g===e?"Today":g;e in c?c[e].push(f):(c[e]=[f],b.push({date:e,timeLogObjArr:c[e]}))}return b},Ga=function(a,c,b,d){var f="validated";if(b>c){for(d=0;d<a.length;++d){var e=a[d];if(e.startTimeStamp<b&&e.endTimeStamp>b||e.startTimeStamp<c&&e.endTimeStamp>c||c<e.endTimeStamp&&b>e.endTimeStamp||c<e.startTimeStamp&&b>e.startTimeStamp)f=new Date(e.endTimeStamp),f=(new Date(e.startTimeStamp)).toLocaleString()+" - "+f.toLocaleString()+
"\n"}"validated"!=f&&(f="Conflict with: "+f)}else f="End time must be greater than start time.";return f},P=function(a){console.assert(a instanceof Array);for(var c=0,b=0;b<a.length;b++){var d=a[b],f=d.startTimeStamp;d=d.endTimeStamp;null!=d&&(f=d-f,console.assert(0<=f),c+=f)}return c},pa=function(a,c){O[a.id]=a;c&&c(!0);C(k.panelStorageId,p.OnEdit,!0)},aa=function(a,c){var b=z(O[a]);c&&c(b)},qa=function(a,c,b,d){Ea(a,function(a){a?(console.log("timelog creation success"),Y(b,"timelog",a.id,u,D,function(b){b?
(console.log("timelog added to task successfully!"),d&&d(a)):(console.log("timelog added to task failed!"),d&&d(null))})):(console.log("timelog creation failed!"),d&&d(null))},c)},Ha=function(a){var c=a.taskObj.id;X(a.panelId,"tasks",c,aa,pa,function(a){a?(console.log("edit panel success"),Z(c,function(a){a?console.log("task remove success!"):console.log("task remove failed!");B()})):(console.log("edit panel failed"),B())})},sa=function(a){var c=a.taskObj.id,b=a.htmlRef.inpSubTasktitle.value,d=a.htmlRef.taskNode.getElementsByClassName("list-sub-tasks")[0];
b&&""!=b&&Ca(b,function(b){b?Y(c,"subtasks",b.id,u,D,function(e){e?(e=ra(b,c),d.appendChild(e),a.htmlRef.inpSubTasktitle.value="",console.log("edit task to add subtask success")):console.log("edit task to add subtask failed!")}):console.log("add subtask failed")})},ta=function(a){var c=a.taskObj;a=a.htmlRef.inpTaskTitle;c.title!=a.value&&""!=a.value&&A(c.id,"title",a.value,u,D,function(a){a?console.log("edit task title success!"):console.log("edit task title failed!")});""==a.value&&(a.value=c.title);
a.disabled=!0},Ia=function(a){var c=a.taskObj.title,b=a.htmlRef.inpTaskDoneChkbox.checked;A(a.taskObj.id,"done",b,u,D,function(a){a?(!0===b&&m.ToggleSnack("Task done - ",c+" at ",(new Date(Date.now())).toLocaleTimeString()),console.log("checked task success!")):console.log("checked task failed!")})},Ja=function(a){var c=a.id;F.IsRunning(function(b){b?(console.log("A timer is already running."),m.ToggleSnack("A timer is already running.")):(b=Date.now(),qa(b,null,c,function(b){b?F.StartTimer(a,b):
console.assert(!1)}))})},ba=function(a){u(a.taskObj.id,function(a){a&&F.IsRunning(function(b){b?m.ToggleSnack("This action is not allowed while timer is still running."):(b=Ka(a),La("Task: "+a.title,b).ShowModal())})})},Ma=function(a){var c=a.subTaskObj.id;X(a.taskId,"subtasks",c,u,D,function(a){a?(console.log("edit task successful!"),Z(c,function(a){a?console.log("remove subtask successful!"):console.log("remove subtask failed!");B()})):(B(),console.log("edit task failed!"))})},Na=function(a){var c=
a.htmlRef.inpSubtaskDoneCheck.checked;u(a.subTaskObj.id,function(a){a.done=c;D(a,function(a){a?console.log("checked subtask success!"):console.log("checked subtask failed!")})})},ua=function(a){var c=a.subTaskObj;a=a.htmlRef.inpSubtaskTitle;c.title!=a.value&&""!=a.value&&A(c.id,"title",a.value,u,D,function(a){a?console.log("edit sub task title success!"):console.log("edit sub task failed!")});""==a.value&&(a.value=c.title);a.disabled=!0},wa=function(a){var c=a.htmlRef.inpAddTask.value,b=a.htmlRef.panelNode.getElementsByClassName("list-tasks")[0],
d=a.panelObj.id;""!=c&&null!=c&&Da(c,function(c){console.assert(c);Y(d,"tasks",c.id,aa,pa,function(e){e?(e=va(c,d),b.appendChild(e),a.htmlRef.inpAddTask.value="",console.log("add task successful!")):console.log("add task failed!")})})},Oa=function(a){var c=a.taskObj,b=a.htmlRef.fromTimePicker,d=a.htmlRef.toTimePicker,f=a.htmlRef.datePicker.value.split("-");b=b.value.split(":");d=d.value.split(":");var e=new Date;e.setYear(f[0]);e.setMonth(f[1]-1);e.setDate(f[2]);e.setHours(b[0]);e.setMinutes(b[1]);
b[2]&&e.setSeconds(b[2]);e=e.valueOf();var g=new Date;g.setYear(f[0]);g.setMonth(f[1]-1);g.setDate(f[2]);g.setHours(d[0]);g.setMinutes(d[1]);d[2]&&g.setSeconds(d[2]);g=g.valueOf();J(c.timelog,E,0,function(b){b?(b=Ga(b,e,g),"validated"===b?qa(e,g,c.id,function(b){b&&(B(),ba(a))}):alert(b)):console.log("Add new timelog failed!")})},Pa=function(a){var c=a.timeLogObj,b=a.taskObj;na(c.id,function(d){d?(console.log("timelog remove success!"),X(b.id,"timelog",c.id,u,D,function(b){b?(console.log("timelog id removed from task success!"),
B(),ba(a)):console.assert(!1)})):console.log("timelog remove failed!")})},Sa=function(a,c){var b=null;Ba(a,function(d){if(d){b=Qa(d);for(var f=0;f<d.panels.length;f++)Ra(d.panels[f],a,function(a){a?b.appendChild(a):console.assert(!1)})}c&&c(b)})},Ra=function(a,c,b){var d=null,f=null;aa(a,function(e){if(e){d=Ta(e,c);f=d.getElementsByClassName("list-tasks")[0];for(var g=0;g<e.tasks.length;g++)Ua(e.tasks[g],a,function(a){a?f.appendChild(a):console.assert(!1)})}b&&b(d)})},Ua=function(a,c,b){var d=null,
f=null;u(a,function(e){if(e){d=va(e,c);f=d.getElementsByClassName("list-sub-tasks")[0];for(var g=0;g<e.subtasks.length;g++)Va(e.subtasks[g],a,function(a){a?f.appendChild(a):console.assert(!1)})}b&&b(d)})},Va=function(a,c,b){var d=null;u(a,function(a){a&&(d=ra(a,c));b&&b(d)})},Qa=function(a){var c=ca.cloneNode(!0),b=c.getElementsByClassName("title-board")[0],d=c.getElementsByClassName("btn-add-panel")[0];c.getElementsByClassName("input-add-panel");b.innerText=a.title;d.addEventListener("click",function(a){});
return c},Ta=function(a,c){var b=da.cloneNode(!0),d=b.getElementsByClassName("title-panel")[0],f=b.getElementsByClassName("btn-add-task")[0],e=b.getElementsByClassName("input-add-task")[0],g=b.getElementsByClassName("btn-remove-panel")[0];d.innerText=a.title;var k={panelObj:a,boardId:c,htmlRef:{panelNode:b,title:d,inpAddTask:e,btnRemovePanel:g}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===e&&wa(k)});f.addEventListener("click",function(a){wa(k)});g.addEventListener("click",
function(a){});return b},va=function(a,c){var b=ea.cloneNode(!0),d=b.getElementsByClassName("btn-move-task")[0],f=b.getElementsByClassName("btn-remove-task")[0],e=b.getElementsByClassName("btn-add-subtask")[0],g=b.getElementsByClassName("btn-start-timer")[0],k=b.getElementsByClassName("btn-open-timelog")[0],h=b.getElementsByClassName("input-task-checkbox-done")[0],x=b.getElementsByClassName("input-task-title")[0],t=b.getElementsByClassName("input-subtask-title")[0],n=b.getElementsByClassName("span-total-time")[0],
l=b.getElementsByClassName("span-on-going-timer")[0];x.value=a.title;h.checked=a.done;J(a.timelog,E,0,function(a){a&&(a=P(a),a=N(a),n.innerText=a.hour+"hr "+a.minute+"m")});var q={taskObj:a,panelId:c,htmlRef:{taskNode:b,btnMoveTask:d,btnRemoveTask:f,btnAddSubTask:e,btnStartTimer:g,btnAddCustomTime:k,inpTaskDoneChkbox:h,inpTaskTitle:x,inpSubTasktitle:t,sTotalTime:n,sOnGoingTime:l}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===t&&sa(q);13===event.keyCode&&
document.activeElement===x&&ta(q)});document.addEventListener("click",function(a){event.target===x?x.disabled=!1:(x.disabled=!0,ta(q))});d.addEventListener("click",function(a){});f.addEventListener("click",function(a){F.IsRunning(function(a){a?m.ToggleSnack("This action is not allowed while timer is still running."):confirm("Are you sure you want to remove this task?")&&Ha(q)})});e.addEventListener("click",function(a){sa(q)});g.addEventListener("click",function(b){Ja(a)});k.addEventListener("click",
function(a){ba(q)});h.addEventListener("click",function(a){Ia(q)});return b},ra=function(a,c){var b=fa.cloneNode(!0),d=b.getElementsByClassName("btn-remove-subtask")[0],f=b.getElementsByClassName("input-subtask-checkbox-done")[0],e=b.getElementsByClassName("input-subtask-title")[0];e.value=a.title;f.checked=a.done;var g={subTaskObj:a,taskId:c,htmlRef:{subTaskNode:b,btnRemoveSubtask:d,inpSubtaskDoneCheck:f,inpSubtaskTitle:e}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===
e&&ua(g)});document.addEventListener("click",function(a){event.target===e?e.disabled=!1:(e.disabled=!0,ua(g))});d.addEventListener("click",function(a){F.IsRunning(function(a){a?m.ToggleSnack("This action is not allowed while timer is still running."):confirm("Are you sure you want to remove this sub-task?")&&Ma(g)})});f.addEventListener("click",function(a){Na(g)});return b},xa=function(a){a=ha.cloneNode(!0);a.getElementsByClassName("timer-task-title");a.getElementsByClassName("timer-task-session-time");
a.getElementsByClassName("timer-task-total-time");a.getElementsByClassName("btn-stop-timer")[0].addEventListener("click",function(a){F.StopTimer()});return a},Ka=function(a){var c=ia.cloneNode(!0),b=c.getElementsByClassName("list-day")[0],d=c.getElementsByClassName("btn-add-entry")[0],f=c.getElementsByClassName("date-picker")[0],e=c.getElementsByClassName("time-picker-from")[0],g=c.getElementsByClassName("time-picker-to")[0],k=c.getElementsByClassName("duration-display")[0],h=(new Date(Date.now())).toLocaleDateString().split("/");
h=h[2]+"-"+y(h[0])+"-"+y(h[1]);f.value=h;e.value="08:00:00";g.value="23:00:00";J(a.timelog,E,0,function(c){c=Fa(c);for(var d=0;d<c.length;++d){var e=a,f=c[d].date,g=c[d].timeLogObjArr,h=ja.cloneNode(!0),k=h.getElementsByClassName("list-hour")[0],l=h.getElementsByClassName("date")[0],t=h.getElementsByClassName("day-duration")[0],m=P(g);m=N(m);l.innerText=f;t.innerText=m.hour.toString()+"h "+m.minute.toString()+"m";for(f=0;f<g.length;f++)l=Wa(e,g[f]),k.appendChild(l);b.appendChild(h)}});var l={taskObj:a,
htmlRef:{panelNode:c,dayList:b,addTimeLog:d,datePicker:f,fromTimePicker:e,toTimePicker:g,durationDisplay:k}};d.addEventListener("click",function(a){Oa(l)});return c},Wa=function(a,c){var b=ka.cloneNode(!0),d=b.getElementsByClassName("time-picker-from")[0],f=b.getElementsByClassName("time-picker-to")[0],e=b.getElementsByClassName("duration")[0],g=b.getElementsByClassName("range")[0],h=b.getElementsByClassName("btn-edit-session")[0],k=b.getElementsByClassName("btn-remove-session")[0],l=T(c.startTimeStamp,
c.endTimeStamp),m=new Date(c.startTimeStamp),n=new Date(c.endTimeStamp);g.innerText=m.toLocaleTimeString()+" - "+n.toLocaleTimeString();e.innerText=l.hour+"hr "+l.minute+"m "+l.second+"s";l=y(m.getHours())+":"+y(m.getMinutes())+":"+y(m.getSeconds());n=y(n.getHours())+":"+y(n.getMinutes())+":"+y(n.getSeconds());d.value=l;f.value=n;var p={taskObj:a,timeLogObj:c,htmlRef:{sessionHourNode:b,fromTimePicker:d,toTimePicker:f,durationTitle:e,rangeTitle:g,btnEditSession:h,btnRemoveSession:k}};d.addEventListener("change",
function(a){});h.addEventListener("click",function(a){confirm("Are you sure you want to modify this session?")});k.addEventListener("click",function(a){confirm("Are you sure you want to remove this session?")&&Pa(p)});return b},B=function(){R&&R.remove();Sa(Xa,function(a){R=a;h.appendChild(R)});F.InitTimer()},La=function(a,c){var b=document.getElementById("global-modal"),d=b.getElementsByClassName("modal-body")[0];b.getElementsByClassName("modal-title")[0].innerText=a;d.innerHTML="";d.appendChild(c);
return{ToggleModal:function(){$("#global-modal").modal("toggle")},HideModal:function(){$("#global-modal").modal("hide")},ShowModal:function(){$("#global-modal").modal("show")}}},m=function(a){var c=document.getElementById("snackbar"),b=[],d=!1,f=function(){c.className=c.className.replace("show","");d=!1;0<b.length&&(c.innerText=b.shift(),c.className="show",setTimeout(f,2E3),d=!0)};return{ToggleSnack:function(a){b.push(a);!1===d&&setTimeout(f,1)}}}(),Xa=1,R=null;W.AuthenticateAndInitDb(function(a){B()});
window.addEventListener("focus",function(){h.style.display="none";W.UpdateChangedFiles(0,!1,function(a){!0===a?window.location.reload(!0):(h.style.display="block",m.ToggleSnack("Synced with Remote Server"))})})});