window.addEventListener("load",function(){var R=function(){return parseInt(Date.now()+10*Math.random()+1)},M=function(a){a/=1E3;var b=parseInt(a/60/60),c=parseInt(a/60%60);a=parseInt(a%60);return{hour:b,minute:c,second:a}},S=function(a,b){var c=b-a;console.assert(0<=c,c);return M(c)},z=function(a){a=a.toString();return 1===a.length?"0"+a:a},A=function(a){return JSON.parse(JSON.stringify(a))},k=null,w={},x={},N={1:{id:1,title:"Todo",createdDate:Date.now(),tasks:[]}},T={1:{id:1,title:"General Board",
createdDate:Date.now(),panels:[1]}},I={modelSettings:{id:"modelSettings",modifiedModel:null,lastModified:Date.now()},timerSettings:{id:"timerSettings",timeLogId:null,taskId:null}},m=document.getElementsByClassName("content-body")[0],ba=m.getElementsByClassName("template-board")[0],ca=m.getElementsByClassName("template-panel")[0],da=m.getElementsByClassName("template-task")[0],ea=m.getElementsByClassName("template-sub-task")[0],fa=m.getElementsByClassName("template-timer")[0],ha=m.getElementsByClassName("template-timelog-panel")[0],
ia=m.getElementsByClassName("template-timelog-session-day")[0],ja=m.getElementsByClassName("template-timelog-session-hour")[0];m.removeChild(ba);m.removeChild(ca);m.removeChild(da);m.removeChild(ea);m.removeChild(fa);m.removeChild(ha);m.removeChild(ia);m.removeChild(ja);var J=Object.freeze({task:"task",subTask:"sub-task"}),G=Object.freeze({timerSettingsId:"timerSettings",modelSettingsId:"modelSettings"}),h=Object.freeze({taskStorageId:"task.json",timelogStorageId:"timelog.json",settingStorageId:"setting.json",
boardStorageId:"board.json",panelStorageId:"panel.json"}),r=Object.freeze({OnAll:"all",OnEdit:"edit",OnRemove:"remove",OnAdd:"add"}),U=function(){var a=null,b=function(){return utils.parseQueryString(window.location.hash).access_token},c=function(a){null==k&&(k={},k["task.json"]={data:{filename:"task.json",content:x}},k["timelog.json"]={data:{filename:"timelog.json",content:w}},k["setting.json"]={data:{filename:"setting.json",content:I}},k["board.json"]={data:{filename:"board.json",content:T}},k["panel.json"]=
{data:{filename:"panel.json",content:N}},l(0,function(b){p.ToggleSnack("Dropbox initialized!");a&&a(!0)}))},d=function(a,b,c){console.assert(a);console.assert(a instanceof Array);if(b<a.length){var f=a[b];g(a[b].name,function(e){e?(console.log(e),null==k&&(k={}),k[e.filename]={data:e,meta:f},"task.json"===e.filename?x=e.content:"timelog.json"===e.filename?w=e.content:"setting.json"===e.filename?I=e.content:"board.json"===e.filename?T=e.content:"panel.json"===e.filename?N=e.content:console.assert(!1,
"Never seen this file before!")):console.log("read failed! -> ",item.name);d(a,b+1,c)})}else c&&c(!0)},e=function(a,b){console.assert(a);var c=[],d=a.length;0<d?a.forEach(function(a){c.push(a);--d;0==d&&b&&b(c)}):b&&b(c)},f=function(b){a.filesListFolder({path:""}).then(function(a){e(a.entries,function(a){console.assert(a);console.assert(a instanceof Array);for(var e=document.getElementById("files"),f=0;f<a.length;f++){var q=a[f].name,g=document.createElement("li");g.innerHTML=q;e.appendChild(g)}0===
a.length?c(b):d(a,0,b)})})["catch"](function(a){console.error(a);b&&b(!1)})},g=function(a,c){var d='{"path": "/'+a+'"}';$.ajax({url:"https://content.dropboxapi.com/2/files/download",type:"POST",dataType:"json",headers:{Authorization:"Bearer "+b(),"Dropbox-API-Arg":d}}).done(function(a){c&&c(a)}).fail(function(a){console.log("error",a);c&&c(null)})},n=function(b,c,d){console.assert(-1<Object.values(h).indexOf(b));var e="/"+b,f=JSON.stringify(c);a.filesUpload({path:e,contents:f,mode:"overwrite"}).then(function(a){console.log(a);
d&&d(a)})["catch"](function(a){console.log(a);console.log("retrying.......");setTimeout(function(){n(b,c,d)},2E3)})},t=function(a,b){var c=!0;null==k?c=!1:Object.values(k).length!=Object.values(h).length&&(c=!1);1==c?n(a,k[a].data,function(c){k[a].meta=c;b&&b(!0)}):b&&b(!1)},l=function(a,b){var c=Object.values(h).sort(),d=c[a];a<c.length?(a+=1,t(d,function(c){c?console.log("remote file updated successfully --\x3e",d):console.log("remote update failed --\x3e",d);l(a,b)})):b&&b()},v=function(b,c,e){var f=
Object.values(h).sort(),q=f[b];b<f.length?a.filesGetMetadata({path:"/"+q}).then(function(a){(new Date(k[q].meta.server_modified)).valueOf()!=(new Date(a.server_modified)).valueOf()?d([a],0,function(a){a?(console.log("Sync with Remote Db ->",q),p.ToggleSnack("Sync with Remote Database"),c=!0):(console.log("Sync with Remote Db Failed! ->",q),p.ToggleSnack("Sync with Remote Failed!"));v(b+1,c,e)}):v(b+1,c,e)})["catch"](function(a){console.log(a);console.log("retrying....");setTimeout(function(){v(b,
c,e)},1E3)}):e&&e(c)};return{AuthenticateAndInitDb:function(c){if(b())document.getElementById("authed-section").style.display="block",a=new Dropbox.Dropbox({accessToken:b()}),f(function(a){a?(p.ToggleSnack("Local database updated!"),c&&c(!0)):(p.ToggleSnack("Local database update failed!"),c&&c(!1))});else{document.getElementById("pre-auth-section").style.display="block";a=new Dropbox.Dropbox({clientId:"1xc4d9cf123830a"});var d=a.getAuthenticationUrl("https://produktiewe.github.io/");document.getElementById("authlink").href=
d;c&&c(!1)}},UpdateRemoteStorage:t,UpdateChangedFiles:v}}(),F=function(){var a=null,b=null,c=null,d=null,e=null,f=0,g=function(a,c){c===r.OnEdit&&a.id===b.id&&H(a.timelog,D,0,function(c){console.log("timerstate updated");b=a;d=c;f=O(c)})},n=function(a){K(G.timerSettingsId,function(b){b||console.log("no timer settings found!");a&&a(b)})},t=function(){if(a&&b&&c&&e&&d){var g=c.getElementsByClassName("timer-task-title")[0],n=c.getElementsByClassName("timer-task-session-time")[0],h=c.getElementsByClassName("timer-task-total-time")[0],
l=Date.now(),v=a.startTimeStamp,k=S(v,l);l=M(f+(l-v));g.innerText=b.title;n.innerText=k.hour.toString()+":"+k.minute.toString()+":"+k.second.toString();h.innerText=l.hour.toString()+":"+l.minute.toString()+":"+l.second.toString();setTimeout(t,200)}},l=function(q,n){console.assert(q);console.assert(n);console.assert(null===a);console.assert(null===b);console.assert(null===d);console.assert(null===e);var xa=n.id;L(G.timerSettingsId,"taskId",q.id,K,P,function(e){e?(console.log("taskId added to app settings successfully"),
L(G.timerSettingsId,"timeLogId",xa,K,P,function(e){e?(console.log("timeLogId added to app settings successfully"),H(q.timelog,D,0,function(e){c=ya(q);a=n;b=q;d=e;f=O(e);p.ToggleSnack("Timer started - "+q.title);m.appendChild(c);setTimeout(t,200)})):(p.ToggleSnack("Timer start failed: 0"),console.log("timeLogId added to app settings failed!"),k())})):(p.ToggleSnack("Timer start failed: 1"),console.log("taskId added to app settings failed!"),k())});e=za(h.taskStorageId,r.OnAll,g)},v=function(c){var d=
Date.now();clearTimeout(t);p.ToggleSnack("Timer stopped for - ",b.title);L(a.id,"endTimeStamp",d,D,Aa,function(a){a?(console.log("set endTimeStamp success!"),k()):console.log("set endTimeStamp failed!");c&&c(a)})},wa=function(){L(G.timerSettingsId,"timeLogId",null,K,P,function(a){a?console.log("timeLogId - cleaned sucess!"):console.log("timeLogId - cleaned failed!")});L(G.timerSettingsId,"taskId",null,K,P,function(a){a?console.log("taskId - cleaned sucess!"):console.log("taskId - cleaned failed!")})},
k=function(){wa();if(e){var g=h.taskStorageId,n=e;console.assert(E);console.assert(-1<Object.values(h).indexOf(g));g=E[g];console.assert(g instanceof Array);for(var t=0;t<g.length;)n===g[t].id?(g.splice(t,1),t=0):t+=1;e=null}c&&m.contains(c)&&m.removeChild(c);d=c=b=a=null;f=0};return{InitTimer:function(){c&&m.removeChild(c);a&&b&&v();n(function(a){a?a.taskId&&a.timeLogId?ka([a.taskId,a.timeLogId],[u,D],null,0,function(a){var b=a[0];a=a[1];b&&a?l(b,a):k()}):(a.taskId||a.timeLogId)&&k():console.log("error timerSettings not found!")})},
StartTimer:function(a,b){l(a,b)},StopTimer:function(a){v(a)},IsRunning:function(a){n(function(b){b?a&&a(b.timeLogId&&b.taskId):a&&a(!1)})}}}(),E=Object.freeze(function(){var a={};a[h.taskStorageId]=[];a[h.timelogStorageId]=[];a[h.settingStorageId]=[];a[h.boardStorageId]=[];a[h.panelStorageId]=[];return a}()),za=function(a,b,c){console.assert(E);console.assert(-1<Object.values(h).indexOf(a));console.assert(-1<Object.values(r).indexOf(b));console.assert("function"===typeof c);var d=R();E[a].push({id:d,
eventType:b,remoteStorageId:a,cb:c});return d},B=function(a,b,c){console.assert(E);console.assert(-1<Object.values(h).indexOf(a));console.assert(-1<Object.values(r).indexOf(b));U.UpdateRemoteStorage(a,function(b){b?(p.ToggleSnack("Remote storage updated"),console.log("remote storage updated --\x3e",a)):(p.ToggleSnack("Remote storage update failed!"),console.log("remote storage update failed! --\x3e",a))});setTimeout(function(){console.assert(E);console.assert(-1<Object.values(h).indexOf(a));console.assert(-1<
Object.values(r).indexOf(b));var d=E[a];console.assert(d instanceof Array);for(var e=0;e<d.length;e++){var f=d[e];f.eventType!==b&&f.eventType!==r.OnAll||f.cb(c,b)}},2)},H=function(a,b,c,d,e){console.assert(Number.isInteger(c));console.assert(a instanceof Array);console.assert("function"===typeof b);e instanceof Array||(e=[]);c<a.length?b(a[c],function(f){e.push(f);c+=1;H(a,b,c,d,e)}):d&&d(e)},ka=function(a,b,c,d,e){console.assert(Number.isInteger(d));console.assert(a instanceof Array);console.assert(b instanceof
Array);console.assert(a.length==b.length);c instanceof Array||(c=[]);if(d<a.length)(0,b[d])(a[d],function(f){c.push(f);d+=1;ka(a,b,c,d,e)});else e(c)},la=function(a,b){console.assert(a instanceof Array);console.assert("function"===typeof b);for(var c=0;c<a.length;c++)b(a[c])},V=function(a,b,c,d,e,f){console.assert("string"===typeof b);console.assert("function"===typeof d);console.assert("function"===typeof e);d(a,function(a){if(a){console.assert(a[b]instanceof Array);var d=a[b],g=d.indexOf(c);-1<
g&&d.splice(g,1);e(a,function(a){f&&f(a)})}else f&&f(!1)})},W=function(a,b,c,d,e,f){console.assert("string"===typeof b);console.assert("function"===typeof d);console.assert("function"===typeof e);d(a,function(a){a?(console.assert(a[b]instanceof Array),a[b].push(c),e(a,function(a){f&&f(a)})):f&&f(!1)})},L=function(a,b,c,d,e,f){console.assert("string"===typeof b);console.assert("function"===typeof d);console.assert("function"===typeof e);d(a,function(a){a?(console.assert(b in a),a[b]?f&&f(!0):(a[b]=
c,e(a,function(a){f&&f(a)}))):f&&f(!1)})},X=function(a,b,c,d,e,f){console.assert("string"===typeof b);console.assert("function"===typeof d);console.assert("function"===typeof e);d(a,function(a){a?(console.assert(b in a),a[b]=c,e(a,function(a){f&&f(a)})):f&&f(!1)})},K=function(a,b){console.assert(-1<Object.values(G).indexOf(a));var c=A(I[a]);b&&b(c)},P=function(a,b){I[a.id]=A(a);b&&b(!0);B(h.settingStorageId,r.OnEdit,I[a.id])},Ba=function(a,b){var c=A(T[a]);b&&b(c)},u=function(a,b){var c=A(x[a]);b&&
b(c)},Y=function(a,b){u(a,function(c){c.type===J.task&&(la(c.timelog,ma),la(c.subtasks,Y));delete x[a];b&&b(!0);B(h.taskStorageId,r.OnRemove,!0)})},C=function(a,b){null===a.doneDate&&1==a.done?a.doneDate=Date.now():(a.doneDate=null,a.done=!1);x[a.id]=A(a);b&&b(!0);B(h.taskStorageId,r.OnEdit,x[a.id])},Ca=function(a,b){na(a,J.subTask,function(a){b&&b(a)})},Da=function(a,b){na(a,J.task,function(a){b&&b(a)})},na=function(a,b,c){console.assert(-1<Object.values(J).indexOf(b));console.assert(a);var d=R();
a={id:d,title:a,done:!1,doneDate:null,type:b,createdDate:Date.now(),timelog:[],subtasks:[]};b==J.subTask&&delete a.subtasks;x[d]=a;c&&c(x[d]);B(h.taskStorageId,r.OnAdd,x[d])},D=function(a,b){var c=A(w[a]);b&&b(c)},ma=function(a,b){delete w[a];b&&b(!0);B(h.timelogStorageId,r.OnRemove,!0)},Aa=function(a,b){var c=a.startTimeStamp,d=a.endTimeStamp;d&&c&&(a.duration=S(c,d));w[a.id]=A(a);b&&b(!0);B(h.timelogStorageId,r.OnEdit,w[a.id])},Ea=function(a,b,c){var d=R(),e=null;c&&(e=c);w[d]={id:d,startTimeStamp:a,
endTimeStamp:e,duration:null};b&&b(w[d]);B(h.timelogStorageId,r.OnAdd,w[d])},Fa=function(a){var b={},c=[];a.sort(function(a,b){return b.startTimeStamp-a.startTimeStamp});for(var d=0;d<a.length;++d){var e=a[d],f=(new Date(Date.now())).toDateString(),g=(new Date(e.startTimeStamp)).toDateString();f=g===f?"Today":g;f in b?b[f].push(e):(b[f]=[e],c.push({date:f,timeLogObjArr:b[f]}))}return c},Ga=function(a,b,c,d){var e="validated";if(c>b){for(d=0;d<a.length;++d){var f=a[d];if(f.startTimeStamp<c&&f.endTimeStamp>
c||f.startTimeStamp<b&&f.endTimeStamp>b||b<f.endTimeStamp&&c>f.endTimeStamp||b<f.startTimeStamp&&c>f.startTimeStamp)e=new Date(f.endTimeStamp),e=(new Date(f.startTimeStamp)).toLocaleString()+" - "+e.toLocaleString()+"\n"}"validated"!=e&&(e="Conflict with: "+e)}else e="End time must be greater than start time.";return e},O=function(a){console.assert(a instanceof Array);for(var b=0,c=0;c<a.length;c++){var d=a[c],e=d.startTimeStamp;d=d.endTimeStamp;null!=d&&(e=d-e,console.assert(0<=e),b+=e)}return b},
oa=function(a,b){N[a.id]=a;b&&b(!0);B(h.panelStorageId,r.OnEdit,!0)},Z=function(a,b){var c=A(N[a]);b&&b(c)},pa=function(a,b,c,d){Ea(a,function(a){a?(console.log("timelog creation success"),W(c,"timelog",a.id,u,C,function(b){b?(console.log("timelog added to task successfully!"),d&&d(a)):(console.log("timelog added to task failed!"),d&&d(null))})):(console.log("timelog creation failed!"),d&&d(null))},b)},Ha=function(a){var b=a.taskObj.id;V(a.panelId,"tasks",b,Z,oa,function(a){a?(console.log("edit panel success"),
Y(b,function(a){a?console.log("task remove success!"):console.log("task remove failed!");y()})):(console.log("edit panel failed"),y())})},ra=function(a){var b=a.taskObj.id,c=a.htmlRef.inpSubTasktitle.value,d=a.htmlRef.taskNode.getElementsByClassName("list-sub-tasks")[0];c&&""!=c&&Ca(c,function(c){c?W(b,"subtasks",c.id,u,C,function(e){e?(e=qa(c,b),d.appendChild(e),a.htmlRef.inpSubTasktitle.value="",console.log("edit task to add subtask success")):console.log("edit task to add subtask failed!")}):console.log("add subtask failed")})},
sa=function(a){var b=a.taskObj;a=a.htmlRef.inpTaskTitle;b.title!=a.value&&""!=a.value&&X(b.id,"title",a.value,u,C,function(a){a?console.log("edit task title success!"):console.log("edit task title failed!")});""==a.value&&(a.value=b.title);a.disabled=!0},Ia=function(a){var b=a.taskObj.title,c=a.htmlRef.inpTaskDoneChkbox.checked;X(a.taskObj.id,"done",c,u,C,function(a){a?(!0===c&&p.ToggleSnack("Task done - ",b+" at ",(new Date(Date.now())).toLocaleTimeString()),console.log("checked task success!")):
console.log("checked task failed!")})},Ja=function(a){F.StopTimer(function(a){y()})},Ka=function(a){var b=a.id;F.IsRunning(function(c){c?(console.log("A timer is already running."),p.ToggleSnack("A timer is already running.")):(c=Date.now(),pa(c,null,b,function(b){b?F.StartTimer(a,b):console.assert(!1)}))})},aa=function(a){u(a.taskObj.id,function(a){a&&F.IsRunning(function(b){b?p.ToggleSnack("This action is not allowed while timer is still running."):(b=La(a),Ma("Task: "+a.title,b).ShowModal())})})},
Na=function(a){var b=a.subTaskObj.id;V(a.taskId,"subtasks",b,u,C,function(a){a?(console.log("edit task successful!"),Y(b,function(a){a?console.log("remove subtask successful!"):console.log("remove subtask failed!");y()})):(y(),console.log("edit task failed!"))})},Oa=function(a){var b=a.htmlRef.inpSubtaskDoneCheck.checked;u(a.subTaskObj.id,function(a){a.done=b;C(a,function(a){a?console.log("checked subtask success!"):console.log("checked subtask failed!")})})},ta=function(a){var b=a.subTaskObj;a=a.htmlRef.inpSubtaskTitle;
b.title!=a.value&&""!=a.value&&X(b.id,"title",a.value,u,C,function(a){a?console.log("edit sub task title success!"):console.log("edit sub task failed!")});""==a.value&&(a.value=b.title);a.disabled=!0},va=function(a){var b=a.htmlRef.inpAddTask.value,c=a.htmlRef.panelNode.getElementsByClassName("list-tasks")[0],d=a.panelObj.id;""!=b&&null!=b&&Da(b,function(b){console.assert(b);W(d,"tasks",b.id,Z,oa,function(e){e?(e=ua(b,d),c.appendChild(e),a.htmlRef.inpAddTask.value="",console.log("add task successful!")):
console.log("add task failed!")})})},Pa=function(a){var b=a.taskObj,c=a.htmlRef.fromTimePicker,d=a.htmlRef.toTimePicker,e=a.htmlRef.datePicker.value.split("-");c=c.value.split(":");d=d.value.split(":");var f=new Date;f.setYear(e[0]);f.setMonth(e[1]-1);f.setDate(e[2]);f.setHours(c[0]);f.setMinutes(c[1]);c[2]&&f.setSeconds(c[2]);f=f.valueOf();var g=new Date;g.setYear(e[0]);g.setMonth(e[1]-1);g.setDate(e[2]);g.setHours(d[0]);g.setMinutes(d[1]);d[2]&&g.setSeconds(d[2]);g=g.valueOf();H(b.timelog,D,0,function(c){c?
(c=Ga(c,f,g),"validated"===c?pa(f,g,b.id,function(b){b&&(y(),aa(a))}):alert(c)):console.log("Add new timelog failed!")})},Qa=function(a){var b=a.timeLogObj,c=a.taskObj;ma(b.id,function(d){d?(console.log("timelog remove success!"),V(c.id,"timelog",b.id,u,C,function(b){b?(console.log("timelog id removed from task success!"),y(),aa(a)):console.assert(!1)})):console.log("timelog remove failed!")})},Ta=function(a,b){var c=null;Ba(a,function(d){if(d){c=Ra(d);for(var e=0;e<d.panels.length;e++)Sa(d.panels[e],
a,function(a){a?c.appendChild(a):console.assert(!1)})}b&&b(c)})},Sa=function(a,b,c){var d=null,e=null;Z(a,function(f){if(f){d=Ua(f,b);e=d.getElementsByClassName("list-tasks")[0];for(var g=0;g<f.tasks.length;g++)Va(f.tasks[g],a,function(a){a?e.appendChild(a):console.assert(!1)})}c&&c(d)})},Va=function(a,b,c){var d=null,e=null;u(a,function(f){if(f){d=ua(f,b);e=d.getElementsByClassName("list-sub-tasks")[0];for(var g=0;g<f.subtasks.length;g++)Wa(f.subtasks[g],a,function(a){a?e.appendChild(a):console.assert(!1)})}c&&
c(d)})},Wa=function(a,b,c){var d=null;u(a,function(a){a&&(d=qa(a,b));c&&c(d)})},Ra=function(a){var b=ba.cloneNode(!0),c=b.getElementsByClassName("title-board")[0],d=b.getElementsByClassName("btn-add-panel")[0];b.getElementsByClassName("input-add-panel");c.innerText=a.title;d.addEventListener("click",function(a){});return b},Ua=function(a,b){var c=ca.cloneNode(!0),d=c.getElementsByClassName("title-panel")[0],e=c.getElementsByClassName("btn-add-task")[0],f=c.getElementsByClassName("input-add-task")[0],
g=c.getElementsByClassName("btn-remove-panel")[0];d.innerText=a.title;var n={panelObj:a,boardId:b,htmlRef:{panelNode:c,title:d,inpAddTask:f,btnRemovePanel:g}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===f&&va(n)});e.addEventListener("click",function(a){va(n)});g.addEventListener("click",function(a){});return c},ua=function(a,b){var c=da.cloneNode(!0),d=c.getElementsByClassName("btn-move-task")[0],e=c.getElementsByClassName("btn-remove-task")[0],f=
c.getElementsByClassName("btn-add-subtask")[0],g=c.getElementsByClassName("btn-start-timer")[0],n=c.getElementsByClassName("btn-open-timelog")[0],t=c.getElementsByClassName("input-task-checkbox-done")[0],l=c.getElementsByClassName("input-task-title")[0],k=c.getElementsByClassName("input-subtask-title")[0],h=c.getElementsByClassName("span-total-time")[0],m=c.getElementsByClassName("span-on-going-timer")[0];l.value=a.title;t.checked=a.done;H(a.timelog,D,0,function(a){a&&(a=O(a),a=M(a),h.innerText=a.hour+
"hr "+a.minute+"m")});var q={taskObj:a,panelId:b,htmlRef:{taskNode:c,btnMoveTask:d,btnRemoveTask:e,btnAddSubTask:f,btnStartTimer:g,btnAddCustomTime:n,inpTaskDoneChkbox:t,inpTaskTitle:l,inpSubTasktitle:k,sTotalTime:h,sOnGoingTime:m}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===k&&ra(q);13===event.keyCode&&document.activeElement===l&&sa(q)});document.addEventListener("click",function(a){event.target===l?l.disabled=!1:(l.disabled=!0,sa(q))});d.addEventListener("click",
function(a){});e.addEventListener("click",function(a){F.IsRunning(function(a){a?p.ToggleSnack("This action is not allowed while timer is still running."):confirm("Are you sure you want to remove this task?")&&Ha(q)})});f.addEventListener("click",function(a){ra(q)});g.addEventListener("click",function(b){Ka(a)});n.addEventListener("click",function(a){aa(q)});t.addEventListener("click",function(a){Ia(q)});return c},qa=function(a,b){var c=ea.cloneNode(!0),d=c.getElementsByClassName("btn-remove-subtask")[0],
e=c.getElementsByClassName("input-subtask-checkbox-done")[0],f=c.getElementsByClassName("input-subtask-title")[0];f.value=a.title;e.checked=a.done;var g={subTaskObj:a,taskId:b,htmlRef:{subTaskNode:c,btnRemoveSubtask:d,inpSubtaskDoneCheck:e,inpSubtaskTitle:f}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===f&&ta(g)});document.addEventListener("click",function(a){event.target===f?f.disabled=!1:(f.disabled=!0,ta(g))});d.addEventListener("click",function(a){F.IsRunning(function(a){a?
p.ToggleSnack("This action is not allowed while timer is still running."):confirm("Are you sure you want to remove this sub-task?")&&Na(g)})});e.addEventListener("click",function(a){Oa(g)});return c},ya=function(a){var b=fa.cloneNode(!0);b.getElementsByClassName("timer-task-title");b.getElementsByClassName("timer-task-session-time");b.getElementsByClassName("timer-task-total-time");b.getElementsByClassName("btn-stop-timer")[0].addEventListener("click",function(b){Ja(a)});return b},La=function(a){var b=
ha.cloneNode(!0),c=b.getElementsByClassName("list-day")[0],d=b.getElementsByClassName("btn-add-entry")[0],e=b.getElementsByClassName("date-picker")[0],f=b.getElementsByClassName("time-picker-from")[0],g=b.getElementsByClassName("time-picker-to")[0],k=b.getElementsByClassName("duration-display")[0],h=(new Date(Date.now())).toLocaleDateString().split("/");h=h[2]+"-"+z(h[0])+"-"+z(h[1]);e.value=h;f.value="08:00:00";g.value="23:00:00";H(a.timelog,D,0,function(b){b=Fa(b);for(var d=0;d<b.length;++d){var e=
a,f=b[d].date,g=b[d].timeLogObjArr,h=ia.cloneNode(!0),k=h.getElementsByClassName("list-hour")[0],l=h.getElementsByClassName("date")[0],m=h.getElementsByClassName("day-duration")[0],n=O(g);n=M(n);l.innerText=f;m.innerText=n.hour.toString()+"h "+n.minute.toString()+"m";for(f=0;f<g.length;f++)l=Xa(e,g[f]),k.appendChild(l);c.appendChild(h)}});var l={taskObj:a,htmlRef:{panelNode:b,dayList:c,addTimeLog:d,datePicker:e,fromTimePicker:f,toTimePicker:g,durationDisplay:k}};d.addEventListener("click",function(a){Pa(l)});
return b},Xa=function(a,b){var c=ja.cloneNode(!0),d=c.getElementsByClassName("time-picker-from")[0],e=c.getElementsByClassName("time-picker-to")[0],f=c.getElementsByClassName("duration")[0],g=c.getElementsByClassName("range")[0],h=c.getElementsByClassName("btn-edit-session")[0],k=c.getElementsByClassName("btn-remove-session")[0],l=S(b.startTimeStamp,b.endTimeStamp),m=new Date(b.startTimeStamp),p=new Date(b.endTimeStamp);g.innerText=m.toLocaleTimeString()+" - "+p.toLocaleTimeString();f.innerText=l.hour+
"hr "+l.minute+"m "+l.second+"s";l=z(m.getHours())+":"+z(m.getMinutes())+":"+z(m.getSeconds());p=z(p.getHours())+":"+z(p.getMinutes())+":"+z(p.getSeconds());d.value=l;e.value=p;var r={taskObj:a,timeLogObj:b,htmlRef:{sessionHourNode:c,fromTimePicker:d,toTimePicker:e,durationTitle:f,rangeTitle:g,btnEditSession:h,btnRemoveSession:k}};d.addEventListener("change",function(a){});h.addEventListener("click",function(a){confirm("Are you sure you want to modify this session?")});k.addEventListener("click",
function(a){confirm("Are you sure you want to remove this session?")&&Qa(r)});return c},y=function(){Q&&Q.remove();Ta(Ya,function(a){Q=a;m.appendChild(Q)});F.InitTimer()},Ma=function(a,b){var c=document.getElementById("global-modal"),d=c.getElementsByClassName("modal-body")[0];c.getElementsByClassName("modal-title")[0].innerText=a;d.innerHTML="";d.appendChild(b);return{ToggleModal:function(){$("#global-modal").modal("toggle")},HideModal:function(){$("#global-modal").modal("hide")},ShowModal:function(){$("#global-modal").modal("show")}}},
p=function(a){var b=document.getElementById("snackbar"),c=[],d=!1,e=function(){b.className=b.className.replace("show","");d=!1;0<c.length&&(b.innerText=c.shift(),b.className="show",setTimeout(e,2E3),d=!0)};return{ToggleSnack:function(a){c.push(a);!1===d&&setTimeout(e,1)}}}(),Ya=1,Q=null;U.AuthenticateAndInitDb(function(a){y()});window.addEventListener("focus",function(){U.UpdateChangedFiles(0,!1,function(a){!0===a&&y()})})});