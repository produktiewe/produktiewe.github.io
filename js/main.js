window.addEventListener("load",function(){var R=function(){return parseInt(Date.now()+10*Math.random()+1)},L=function(a){a/=1E3;var c=parseInt(a/60/60),b=parseInt(a/60%60);a=parseInt(a%60);return{hour:c,minute:b,second:a}},S=function(a,c){var b=c-a;console.assert(0<=b,b);return L(b)},w=function(a){a=a.toString();return 1===a.length?"0"+a:a},x=function(a){var c=null;try{c=JSON.parse(JSON.stringify(a))}catch(b){console.log(b)}return c},ya=function(a){console.assert(a instanceof Array);for(var c={},
    b=0;b<a.length;b++)c[a[b]]=1;return Object.keys(c)},l=null,t={},u={},M={1:{id:1,title:"Todo",createdDate:Date.now(),tasks:[]}},T={1:{id:1,title:"General Board",createdDate:Date.now(),panels:[1]}},H={modelSettings:{id:"modelSettings",modifiedModel:null,lastModified:Date.now()},timerSettings:{id:"timerSettings",timeLogId:null,taskId:null}},h=document.getElementsByClassName("content-body")[0],ca=h.getElementsByClassName("template-board")[0],da=h.getElementsByClassName("template-panel")[0],ea=h.getElementsByClassName("template-task")[0],
    fa=h.getElementsByClassName("template-sub-task")[0],ha=h.getElementsByClassName("template-timer")[0],ia=h.getElementsByClassName("template-timelog-panel")[0],ja=h.getElementsByClassName("template-timelog-session-day")[0],ka=h.getElementsByClassName("template-timelog-session-hour")[0];h.removeChild(ca);h.removeChild(da);h.removeChild(ea);h.removeChild(fa);h.removeChild(ha);h.removeChild(ia);h.removeChild(ja);h.removeChild(ka);var I=Object.freeze({task:"task",subTask:"sub-task"}),F=Object.freeze({timerSettingsId:"timerSettings",
    modelSettingsId:"modelSettings"}),k=Object.freeze({taskStorageId:"task.json",timelogStorageId:"timelog.json",settingStorageId:"setting.json",boardStorageId:"board.json",panelStorageId:"panel.json"}),m=Object.freeze({OnAll:"all",OnEdit:"edit",OnRemove:"remove",OnAdd:"add"}),V=function(){var a=0,c=[],b=null,d=function(){U.OverlayOn("Saving...");window.onbeforeunload=function(a){a.preventDefault();return""}},f=function(a){U.OverlayOn(1==a?"Success!":"Failed");setTimeout(function(){U.OverlayOff()},500);
    window.onbeforeunload=null},e=function(){return utils.parseQueryString(window.location.hash).access_token},g=function(a){null==l&&(l={},l["task.json"]={data:{filename:"task.json",content:u}},l["timelog.json"]={data:{filename:"timelog.json",content:t}},l["setting.json"]={data:{filename:"setting.json",content:H}},l["board.json"]={data:{filename:"board.json",content:T}},l["panel.json"]={data:{filename:"panel.json",content:M}},N(0,function(b){p.ToggleSnack("Dropbox initialized!");a&&a(!0)}))},r=function(a,
    b){var c=a.map(function(a){return O(a.name).then(function(b){b?(console.log(b),null==l&&(l={}),l[b.filename]={data:b,meta:a},"task.json"===b.filename?u=b.content:"timelog.json"===b.filename?t=b.content:"setting.json"===b.filename?H=b.content:"board.json"===b.filename?T=b.content:"panel.json"===b.filename?M=b.content:console.assert(!1,"Never seen this file before!")):console.assert(!1,"Empty data object!")})});return Promise.all(c).then(function(a){console.log("Update Local DB Success!");b&&b(!0)})["catch"](function(a){console.log("Ajax request failed -> ",
    a);b&&b(!1)})},J=function(a,b){console.assert(a);var c=[],d=a.length;0<d?a.forEach(function(a){c.push(a);--d;0==d&&b&&b(c)}):b&&b(c)},h=function(a){b.filesListFolder({path:""}).then(function(b){J(b.entries,function(b){console.assert(b);console.assert(b instanceof Array);for(var c=document.getElementById("files"),d=0;d<b.length;d++){var f=b[d].name,e=document.createElement("li");e.innerHTML=f;c.appendChild(e)}0===b.length?g(a):r(b,a)})})["catch"](function(b){console.error(b);a&&a(!1)})},O=function(a){var b=
    '{"path": "/'+a+'"}';return new Promise(function(c,d){$.ajax({url:"https://content.dropboxapi.com/2/files/download",type:"POST",dataType:"json",headers:{Authorization:"Bearer "+e(),"Dropbox-API-Arg":b}}).done(function(a){c(a)}).fail(function(b){d(Error("Ajax failed for:",a))})})},B=function(a,c,d){console.assert(-1<Object.values(k).indexOf(a));var f="/"+a,e=JSON.stringify(c);b.filesUpload({path:f,contents:e,mode:"overwrite"}).then(function(a){console.log(a);d&&d(a)})["catch"](function(b){console.log(b);
    console.log("retrying.......");setTimeout(function(){B(a,c,d)},2E3)})},m=function(){var b=c.length;if(0<b)if(a!=b)a=b,setTimeout(m,2);else{var d=ya(c);c=[];a=0;b=[];for(var e={$jscomp$loop$prop$i$3:0};e.$jscomp$loop$prop$i$3<d.length;e={$jscomp$loop$prop$i$3:e.$jscomp$loop$prop$i$3},e.$jscomp$loop$prop$i$3++){var g=new Promise(function(a){return function(b){q(d[a.$jscomp$loop$prop$i$3],function(c){b({updated:d[a.$jscomp$loop$prop$i$3],result:c})})}}(e));b.push(g)}Promise.all(b).then(function(a){for(var b=
    !0,c=0;c<a.length;c++)b&=a[c].result;f(b);setTimeout(m,2)})}else setTimeout(m,2)},q=function(a,b){var c=!0;null==l?c=!1:Object.values(l).length!=Object.values(k).length&&(c=!1);1==c?B(a,l[a].data,function(c){l[a].meta=c;b&&b(!0)}):b&&b(!1)},N=function(a,b){var c=Object.values(k).sort(),d=c[a];a<c.length?(a+=1,q(d,function(c){c?console.log("remote file updated successfully --\x3e",d):console.log("remote update failed --\x3e",d);N(a,b)})):b&&b()},Aa=function(){var a=Object.values(k).sort().map(function(a){return b.filesGetMetadata({path:"/"+
    a}).then(function(b){return{meta:b,remoteId:a}})});return Promise.all(a)},n=function(){return Aa().then(function(a){var b=[];a.forEach(function(a){var c=a.meta;(new Date(l[a.remoteId].meta.server_modified)).valueOf()!=(new Date(c.server_modified)).valueOf()&&b.push(c)});return b})};return{AuthenticateAndInitDb:function(a){if(e())document.getElementById("authed-section").style.display="block",b=new Dropbox.Dropbox({accessToken:e()}),h(function(b){b?(setTimeout(m,2),p.ToggleSnack("Local database updated!"),
    a&&a(!0)):(p.ToggleSnack("Local database update failed!"),a&&a(!1))});else{document.getElementById("pre-auth-section").style.display="block";b=new Dropbox.Dropbox({clientId:"1xc4d9cf123830a"});var c=b.getAuthenticationUrl("https://produktiewe.github.io/");document.getElementById("authlink").href=c;a&&a(!1)}},QueueUpdateRemoteStorage:function(a){c.push(a);d()},UpdateChangedFiles:function(a){return n().then(function(b){if(0<b.length)return r(b).then(function(b){b?p.ToggleSnack("Sync with Remote Database"):
    p.ToggleSnack("Sync with Remote Failed, Please Reload Page");a&&a(!0)});a&&a(!1)})}}}(),D=function(){var a=null,c=null,b=null,d=null,f=null,e=0,g=function(a,b){b===m.OnEdit&&a.id===c.id&&G(a.timelog,C,0,function(b){console.log("timerstate updated");c=a;d=b;e=P(b)})},r=function(a){K(F.timerSettingsId,function(b){b||console.log("no timer settings found!");a&&a(b)})},J=function(){if(a&&c&&b&&f&&d){var g=b.getElementsByClassName("timer-task-title")[0],N=b.getElementsByClassName("timer-task-session-time")[0],
    r=b.getElementsByClassName("timer-task-total-time")[0],h=Date.now(),k=a.startTimeStamp,l=S(k,h);h=L(e+(h-k));g.innerText=c.title;N.innerText=l.hour.toString()+":"+l.minute.toString()+":"+l.second.toString();r.innerText=h.hour.toString()+":"+h.minute.toString()+":"+h.second.toString();setTimeout(J,200)}},za=function(a,b,c){y(F.timerSettingsId,"taskId",a,K,Q,function(a){a?(console.log("taskId added to app settings successfully"),y(F.timerSettingsId,"timeLogId",b,K,Q,function(a){a?(console.log("timeLogId added to app settings successfully"),
    c&&c(!0)):(console.log("timeLogId added to app settings failed!"),c&&c(!1))})):(console.log("taskId added to app settings failed!"),c&&c(!1))})},O=function(q,r){console.assert(q);console.assert(r);console.assert(null===a);console.assert(null===c);console.assert(null===d);console.assert(null===f);G(q.timelog,C,0,function(f){b=Ba(q);a=r;c=q;d=f;e=P(f);p.ToggleSnack("Timer started - "+q.title);h.appendChild(b);setTimeout(J,200)});f=Ca(k.taskStorageId,m.OnAll,g)},B=function(){var b=Date.now();clearTimeout(J);
    p.ToggleSnack("Timer stopped for - "+c.title);y(a.id,"endTimeStamp",b,C,Da,function(a){a?(console.log("set endTimeStamp success!"),l(),v()):console.log("set endTimeStamp faield!")})},l=function(){y(F.timerSettingsId,"timeLogId",null,K,Q,function(a){a?console.log("timeLogId - cleaned sucess!"):console.log("timeLogId - cleaned failed!")});y(F.timerSettingsId,"taskId",null,K,Q,function(a){a?console.log("taskId - cleaned sucess!"):console.log("taskId - cleaned failed!")});f&&(Ea(k.taskStorageId,f),f=
    null);b&&h.contains(b)&&h.removeChild(b);d=b=c=a=null;e=0};return{InitTimer:function(){b&&b.remove();f=d=b=c=a=null;e=0;r(function(a){a?a.taskId&&a.timeLogId?la([a.taskId,a.timeLogId],[n,C],null,0,function(a){var b=a[0];a=a[1];b&&a?O(b,a):l()}):(a.taskId||a.timeLogId)&&l():console.log("error timerSettings not found!")})},StartTimer:function(a,b){a&&b&&za(a.id,b.id,function(c){!0===c?O(a,b):p.ToggleSnack("Start Timer Failed")})},StopTimer:function(){B()},IsRunning:function(a){r(function(b){b?a&&a(b.timeLogId&&
    b.taskId):a&&a(!1)})}}}(),E=Object.freeze(function(){var a={};a[k.taskStorageId]=[];a[k.timelogStorageId]=[];a[k.settingStorageId]=[];a[k.boardStorageId]=[];a[k.panelStorageId]=[];return a}()),Ea=function(a,c){console.assert(E);console.assert(-1<Object.values(k).indexOf(a));var b=E[a];console.assert(b instanceof Array);for(var d=0;d<b.length;)c===b[d].id?(b.splice(d,1),d=0):d+=1},Ca=function(a,c,b){console.assert(E);console.assert(-1<Object.values(k).indexOf(a));console.assert(-1<Object.values(m).indexOf(c));
    console.assert("function"===typeof b);var d=R();E[a].push({id:d,eventType:c,remoteStorageId:a,cb:b});return d},z=function(a,c,b){console.assert(E);console.assert(-1<Object.values(k).indexOf(a));console.assert(-1<Object.values(m).indexOf(c));V.QueueUpdateRemoteStorage(a);setTimeout(function(){console.assert(E);console.assert(-1<Object.values(k).indexOf(a));console.assert(-1<Object.values(m).indexOf(c));var d=E[a];console.assert(d instanceof Array);for(var f=0;f<d.length;f++){var e=d[f];e.eventType!==
    c&&e.eventType!==m.OnAll||e.cb(b,c)}},2)},G=function(a,c,b,d,f){console.assert(Number.isInteger(b));console.assert(a instanceof Array);console.assert("function"===typeof c);f instanceof Array||(f=[]);b<a.length?c(a[b],function(e){f.push(e);b+=1;G(a,c,b,d,f)}):d&&d(f)},la=function(a,c,b,d,f){console.assert(Number.isInteger(d));console.assert(a instanceof Array);console.assert(c instanceof Array);console.assert(a.length==c.length);b instanceof Array||(b=[]);if(d<a.length)(0,c[d])(a[d],function(e){b.push(e);
    d+=1;la(a,c,b,d,f)});else f(b)},ma=function(a,c){console.assert(a instanceof Array);console.assert("function"===typeof c);for(var b=0;b<a.length;b++)c(a[b])},W=function(a,c,b,d,f,e){console.assert("string"===typeof c);console.assert("function"===typeof d);console.assert("function"===typeof f);d(a,function(a){if(a){console.assert(a[c]instanceof Array);var d=a[c],g=d.indexOf(b);-1<g&&d.splice(g,1);f(a,function(a){e&&e(a)})}else e&&e(!1)})},X=function(a,c,b,d,f,e){console.assert("string"===typeof c);
    console.assert("function"===typeof d);console.assert("function"===typeof f);d(a,function(a){a?(console.assert(a[c]instanceof Array),a[c].push(b),f(a,function(a){e&&e(a)})):e&&e(!1)})},y=function(a,c,b,d,f,e){console.assert("string"===typeof c);console.assert("function"===typeof d);console.assert("function"===typeof f);d(a,function(a){a?(console.assert(c in a),a[c]=b,f(a,function(a){e&&e(a)})):e&&e(!1)})},K=function(a,c){console.assert(-1<Object.values(F).indexOf(a));var b=x(H[a]);c&&c(b)},Q=function(a,
    c){H[a.id]=x(a);c&&c(!0);z(k.settingStorageId,m.OnEdit,H[a.id])},Fa=function(a,c){var b=x(T[a]);c&&c(b)},n=function(a,c){var b=x(u[a]);c&&c(b)},Y=function(a,c){n(a,function(b){b.type===I.task&&(ma(b.timelog,na),ma(b.subtasks,Y));delete u[a];c&&c(!0);z(k.taskStorageId,m.OnRemove,!0)})},A=function(a,c){null===a.doneDate&&1==a.done?a.doneDate=Date.now():(a.doneDate=null,a.done=!1);u[a.id]=x(a);c&&c(!0);z(k.taskStorageId,m.OnEdit,u[a.id])},Ga=function(a,c){oa(a,I.subTask,function(a){c&&c(a)})},Ha=function(a,
    c){oa(a,I.task,function(a){c&&c(a)})},oa=function(a,c,b){console.assert(-1<Object.values(I).indexOf(c));console.assert(a);var d=R();a={id:d,title:a,done:!1,doneDate:null,type:c,createdDate:Date.now(),timelog:[],subtasks:[]};c==I.subTask&&delete a.subtasks;u[d]=a;b&&b(u[d]);z(k.taskStorageId,m.OnAdd,u[d])},C=function(a,c){var b=x(t[a]);c&&c(b)},na=function(a,c){delete t[a];c&&c(!0);z(k.timelogStorageId,m.OnRemove,!0)},Da=function(a,c){var b=a.startTimeStamp,d=a.endTimeStamp;d&&b&&(a.duration=S(b,d));
    t[a.id]=x(a);c&&c(!0);z(k.timelogStorageId,m.OnEdit,t[a.id])},Ia=function(a,c,b){var d=R(),f=null;b&&(f=b);t[d]={id:d,startTimeStamp:a,endTimeStamp:f,duration:null};c&&c(t[d]);z(k.timelogStorageId,m.OnAdd,t[d])},Ja=function(a){var c={},b=[];a.sort(function(a,b){return b.startTimeStamp-a.startTimeStamp});for(var d=0;d<a.length;++d){var f=a[d],e=(new Date(Date.now())).toDateString(),g=(new Date(f.startTimeStamp)).toDateString();e=g===e?"Today":g;e in c?c[e].push(f):(c[e]=[f],b.push({date:e,timeLogObjArr:c[e]}))}return b},
    Ka=function(a,c,b,d){var f="validated";if(b>c){for(d=0;d<a.length;++d){var e=a[d];if(e.startTimeStamp<b&&e.endTimeStamp>b||e.startTimeStamp<c&&e.endTimeStamp>c||c<e.endTimeStamp&&b>e.endTimeStamp||c<e.startTimeStamp&&b>e.startTimeStamp)f=new Date(e.endTimeStamp),f=(new Date(e.startTimeStamp)).toLocaleString()+" - "+f.toLocaleString()+"\n"}"validated"!=f&&(f="Conflict with: "+f)}else f="End time must be greater than start time.";return f},P=function(a){console.assert(a instanceof Array);for(var c=
    0,b=0;b<a.length;b++){var d=a[b],f=d.startTimeStamp;d=d.endTimeStamp;null!=d&&(f=d-f,console.assert(0<=f),c+=f)}return c},pa=function(a,c){M[a.id]=a;c&&c(!0);z(k.panelStorageId,m.OnEdit,!0)},Z=function(a,c){var b=x(M[a]);c&&c(b)},qa=function(a,c,b,d){Ia(a,function(a){a?(console.log("timelog creation success"),X(b,"timelog",a.id,n,A,function(b){b?(console.log("timelog added to task successfully!"),d&&d(a)):(console.log("timelog added to task failed!"),d&&d(null))})):(console.log("timelog creation failed!"),
    d&&d(null))},c)},La=function(a){var c=a.taskObj.id;W(a.panelId,"tasks",c,Z,pa,function(a){a?(console.log("edit panel success"),Y(c,function(a){a?console.log("task remove success!"):console.log("task remove failed!");v()})):(console.log("edit panel failed"),v())})},sa=function(a){var c=a.taskObj.id,b=a.htmlRef.inpSubTasktitle.value,d=a.htmlRef.taskNode.getElementsByClassName("list-sub-tasks")[0];b&&""!=b&&Ga(b,function(b){b?X(c,"subtasks",b.id,n,A,function(e){e?(e=ra(b,c),d.appendChild(e),a.htmlRef.inpSubTasktitle.value=
    "",console.log("edit task to add subtask success")):console.log("edit task to add subtask failed!")}):console.log("add subtask failed")})},ta=function(a){var c=a.taskObj;a=a.htmlRef.inpTaskTitle;c.title!=a.value&&""!=a.value&&y(c.id,"title",a.value,n,A,function(a){a?console.log("edit task title success!"):console.log("edit task title failed!")});""==a.value&&(a.value=c.title);a.disabled=!0},Ma=function(a){var c=a.taskObj.title,b=a.htmlRef.inpTaskDoneChkbox.checked;y(a.taskObj.id,"done",b,n,A,function(a){a?
    (!0===b&&p.ToggleSnack("Task done - ",c+" at ",(new Date(Date.now())).toLocaleTimeString()),console.log("checked task success!")):console.log("checked task failed!")})},Na=function(a){var c=a.id;D.IsRunning(function(b){b?(console.log("A timer is already running."),p.ToggleSnack("A timer is already running.")):(b=Date.now(),qa(b,null,c,function(b){b?D.StartTimer(a,b):console.assert(!1)}))})},aa=function(a){n(a.taskObj.id,function(a){a&&D.IsRunning(function(b){b?p.ToggleSnack("This action is not allowed while timer is still running."):
    (b=Oa(a),ua.InitModal("Task: "+a.title,b),ua.ShowModal())})})},Pa=function(a){var c=a.subTaskObj.id;W(a.taskId,"subtasks",c,n,A,function(a){a?(console.log("edit task successful!"),Y(c,function(a){a?console.log("remove subtask successful!"):console.log("remove subtask failed!");v()})):(v(),console.log("edit task failed!"))})},Qa=function(a){var c=a.htmlRef.inpSubtaskDoneCheck.checked;n(a.subTaskObj.id,function(a){a.done=c;A(a,function(a){a?console.log("checked subtask success!"):console.log("checked subtask failed!")})})},
    va=function(a){var c=a.subTaskObj;a=a.htmlRef.inpSubtaskTitle;c.title!=a.value&&""!=a.value&&y(c.id,"title",a.value,n,A,function(a){a?console.log("edit sub task title success!"):console.log("edit sub task failed!")});""==a.value&&(a.value=c.title);a.disabled=!0},xa=function(a){var c=a.htmlRef.inpAddTask.value,b=a.htmlRef.panelNode.getElementsByClassName("list-tasks")[0],d=a.panelObj.id;""!=c&&null!=c&&Ha(c,function(c){console.assert(c);X(d,"tasks",c.id,Z,pa,function(e){e?(e=wa(c,d),b.appendChild(e),
    a.htmlRef.inpAddTask.value="",console.log("add task successful!")):console.log("add task failed!")})})},Ra=function(a){var c=a.taskObj,b=a.htmlRef.fromTimePicker,d=a.htmlRef.toTimePicker,f=a.htmlRef.datePicker.value.split("-");b=b.value.split(":");d=d.value.split(":");var e=new Date;e.setYear(f[0]);e.setMonth(f[1]-1);e.setDate(f[2]);e.setHours(b[0]);e.setMinutes(b[1]);b[2]&&e.setSeconds(b[2]);e=e.valueOf();var g=new Date;g.setYear(f[0]);g.setMonth(f[1]-1);g.setDate(f[2]);g.setHours(d[0]);g.setMinutes(d[1]);
    d[2]&&g.setSeconds(d[2]);g=g.valueOf();G(c.timelog,C,0,function(b){b?(b=Ka(b,e,g),"validated"===b?qa(e,g,c.id,function(b){b&&(v(),aa(a))}):alert(b)):console.log("Add new timelog failed!")})},Sa=function(a){var c=a.timeLogObj,b=a.taskObj;na(c.id,function(d){d?(console.log("timelog remove success!"),W(b.id,"timelog",c.id,n,A,function(b){b?(console.log("timelog id removed from task success!"),v(),aa(a)):console.assert(!1)})):console.log("timelog remove failed!")})},Va=function(a,c){var b=null;Fa(a,function(d){if(d){b=
    Ta(d);for(var f=0;f<d.panels.length;f++)Ua(d.panels[f],a,function(a){a?b.appendChild(a):console.assert(!1)})}c&&c(b)})},Ua=function(a,c,b){var d=null,f=null;Z(a,function(e){if(e){d=Wa(e,c);f=d.getElementsByClassName("list-tasks")[0];for(var g=0;g<e.tasks.length;g++)Xa(e.tasks[g],a,function(a){a?f.appendChild(a):console.assert(!1)})}b&&b(d)})},Xa=function(a,c,b){var d=null,f=null;n(a,function(e){if(e){d=wa(e,c);f=d.getElementsByClassName("list-sub-tasks")[0];for(var g=0;g<e.subtasks.length;g++)Ya(e.subtasks[g],
    a,function(a){a?f.appendChild(a):console.assert(!1)})}b&&b(d)})},Ya=function(a,c,b){var d=null;n(a,function(a){a&&(d=ra(a,c));b&&b(d)})},Ta=function(a){var c=ca.cloneNode(!0),b=c.getElementsByClassName("title-board")[0],d=c.getElementsByClassName("btn-add-panel")[0];c.getElementsByClassName("input-add-panel");b.innerText=a.title;d.addEventListener("click",function(a){});return c},Wa=function(a,c){var b=da.cloneNode(!0),d=b.getElementsByClassName("title-panel")[0],f=b.getElementsByClassName("btn-add-task")[0],
    e=b.getElementsByClassName("input-add-task")[0],g=b.getElementsByClassName("btn-remove-panel")[0];d.innerText=a.title;var h={panelObj:a,boardId:c,htmlRef:{panelNode:b,title:d,inpAddTask:e,btnRemovePanel:g}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===e&&xa(h)});f.addEventListener("click",function(a){xa(h)});g.addEventListener("click",function(a){});return b},wa=function(a,c){var b=ea.cloneNode(!0),d=b.getElementsByClassName("btn-move-task")[0],f=b.getElementsByClassName("btn-remove-task")[0],
    e=b.getElementsByClassName("btn-add-subtask")[0],g=b.getElementsByClassName("btn-start-timer")[0],h=b.getElementsByClassName("btn-open-timelog")[0],k=b.getElementsByClassName("input-task-checkbox-done")[0],l=b.getElementsByClassName("input-task-title")[0],m=b.getElementsByClassName("input-subtask-title")[0],B=b.getElementsByClassName("span-total-time")[0],n=b.getElementsByClassName("span-on-going-timer")[0];l.value=a.title;k.checked=a.done;G(a.timelog,C,0,function(a){a&&(a=P(a),a=L(a),B.innerText=
    a.hour+"hr "+a.minute+"m")});var q={taskObj:a,panelId:c,htmlRef:{taskNode:b,btnMoveTask:d,btnRemoveTask:f,btnAddSubTask:e,btnStartTimer:g,btnAddCustomTime:h,inpTaskDoneChkbox:k,inpTaskTitle:l,inpSubTasktitle:m,sTotalTime:B,sOnGoingTime:n}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===m&&sa(q);13===event.keyCode&&document.activeElement===l&&ta(q)});document.addEventListener("click",function(a){event.target===l?l.disabled=!1:(l.disabled=!0,ta(q))});d.addEventListener("click",
    function(a){});f.addEventListener("click",function(a){D.IsRunning(function(a){a?p.ToggleSnack("This action is not allowed while timer is still running."):confirm("Are you sure you want to remove this task?")&&La(q)})});e.addEventListener("click",function(a){sa(q)});g.addEventListener("click",function(b){Na(a)});h.addEventListener("click",function(a){aa(q)});k.addEventListener("click",function(a){Ma(q)});return b},ra=function(a,c){var b=fa.cloneNode(!0),d=b.getElementsByClassName("btn-remove-subtask")[0],
    f=b.getElementsByClassName("input-subtask-checkbox-done")[0],e=b.getElementsByClassName("input-subtask-title")[0];e.value=a.title;f.checked=a.done;var g={subTaskObj:a,taskId:c,htmlRef:{subTaskNode:b,btnRemoveSubtask:d,inpSubtaskDoneCheck:f,inpSubtaskTitle:e}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===e&&va(g)});document.addEventListener("click",function(a){event.target===e?e.disabled=!1:(e.disabled=!0,va(g))});d.addEventListener("click",function(a){D.IsRunning(function(a){a?
    p.ToggleSnack("This action is not allowed while timer is still running."):confirm("Are you sure you want to remove this sub-task?")&&Pa(g)})});f.addEventListener("click",function(a){Qa(g)});return b},Ba=function(a){a=ha.cloneNode(!0);a.getElementsByClassName("timer-task-title");a.getElementsByClassName("timer-task-session-time");a.getElementsByClassName("timer-task-total-time");a.getElementsByClassName("btn-stop-timer")[0].addEventListener("click",function(a){D.StopTimer()});return a},Oa=function(a){var c=
    ia.cloneNode(!0),b=c.getElementsByClassName("list-day")[0],d=c.getElementsByClassName("btn-add-entry")[0],f=c.getElementsByClassName("date-picker")[0],e=c.getElementsByClassName("time-picker-from")[0],g=c.getElementsByClassName("time-picker-to")[0],h=c.getElementsByClassName("duration-display")[0],l=(new Date(Date.now())).toLocaleDateString().split("/");l=l[2]+"-"+w(l[0])+"-"+w(l[1]);f.value=l;e.value="08:00:00";g.value="23:00:00";G(a.timelog,C,0,function(c){c=Ja(c);for(var d=0;d<c.length;++d){var e=
    a,f=c[d].date,g=c[d].timeLogObjArr,h=ja.cloneNode(!0),l=h.getElementsByClassName("list-hour")[0],k=h.getElementsByClassName("date")[0],m=h.getElementsByClassName("day-duration")[0],n=P(g);n=L(n);k.innerText=f;m.innerText=n.hour.toString()+"h "+n.minute.toString()+"m";for(f=0;f<g.length;f++)k=Za(e,g[f]),l.appendChild(k);b.appendChild(h)}});var k={taskObj:a,htmlRef:{panelNode:c,dayList:b,addTimeLog:d,datePicker:f,fromTimePicker:e,toTimePicker:g,durationDisplay:h}};d.addEventListener("click",function(a){Ra(k)});
    return c},Za=function(a,c){var b=ka.cloneNode(!0),d=b.getElementsByClassName("time-picker-from")[0],f=b.getElementsByClassName("time-picker-to")[0],e=b.getElementsByClassName("duration")[0],g=b.getElementsByClassName("range")[0],h=b.getElementsByClassName("btn-edit-session")[0],l=b.getElementsByClassName("btn-remove-session")[0],k=S(c.startTimeStamp,c.endTimeStamp),m=new Date(c.startTimeStamp),n=new Date(c.endTimeStamp);g.innerText=m.toLocaleTimeString()+" - "+n.toLocaleTimeString();e.innerText=k.hour+
    "hr "+k.minute+"m "+k.second+"s";k=w(m.getHours())+":"+w(m.getMinutes())+":"+w(m.getSeconds());n=w(n.getHours())+":"+w(n.getMinutes())+":"+w(n.getSeconds());d.value=k;f.value=n;var p={taskObj:a,timeLogObj:c,htmlRef:{sessionHourNode:b,fromTimePicker:d,toTimePicker:f,durationTitle:e,rangeTitle:g,btnEditSession:h,btnRemoveSession:l}};d.addEventListener("change",function(a){});h.addEventListener("click",function(a){confirm("Are you sure you want to modify this session?")});l.addEventListener("click",
    function(a){confirm("Are you sure you want to remove this session?")&&Sa(p)});return b},v=function(){Va($a,function(a){ba?h.replaceChild(a,ba):h.appendChild(a);ba=a});D.InitTimer()},ua=function(){var a=document.getElementById("global-modal"),c=a.getElementsByClassName("modal-body")[0],b=a.getElementsByClassName("modal-title")[0];return{InitModal:function(a,f){b.innerText=a;c.innerHTML="";c.appendChild(f)},ToggleModal:function(){$("#global-modal").modal("toggle")},HideModal:function(){$("#global-modal").modal("hide")},
    ShowModal:function(){$("#global-modal").modal("show")}}}(),p=function(){var a=document.getElementById("snackbar"),c=[],b=!1,d=function(){a.className=a.className.replace("show","");b=!1;0<c.length&&(a.innerText=c.shift(),a.className="show",setTimeout(d,2E3),b=!0)};return{ToggleSnack:function(a){c.push(a);!1===b&&setTimeout(d,1)}}}(),U=function(){var a=document.getElementById("overlay"),c=a.getElementsByClassName("overlay-text")[0];return{OverlayOn:function(b){c.innerText=b;a.style.display="block"},
    OverlayOff:function(){a.style.display="none"}}}(),$a=1,ba=null;V.AuthenticateAndInitDb(function(a){v()});window.addEventListener("focus",function(){h.style.display="none";V.UpdateChangedFiles(function(a){!0===a?(v(),h.style.display="block",p.ToggleSnack("Updated with Remote Server")):(h.style.display="block",p.ToggleSnack("No Updates with Remote Server"))})})});