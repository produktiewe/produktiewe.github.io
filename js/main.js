window.addEventListener("load",function(){var S=function(){return parseInt(Date.now()+10*Math.random()+1)},N=function(a){a/=1E3;var c=parseInt(a/60/60),b=parseInt(a/60%60);a=parseInt(a%60);return{hour:c,minute:b,second:a}},T=function(a,c){var b=c-a;console.assert(0<=b,b);return N(b)},w=function(a){a=a.toString();return 1===a.length?"0"+a:a},x=function(a){var c=null;try{c=JSON.parse(JSON.stringify(a))}catch(b){console.log(b)}return c},za=function(a){console.assert(a instanceof Array);for(var c={},
b=0;b<a.length;b++)c[a[b]]=1;return Object.keys(c)},l=null,t={},u={},O={1:{id:1,title:"Todo",createdDate:Date.now(),tasks:[]}},U={1:{id:1,title:"General Board",createdDate:Date.now(),panels:[1]}},J={modelSettings:{id:"modelSettings",modifiedModel:null,lastModified:Date.now()},timerSettings:{id:"timerSettings",timeLogId:null,taskId:null}},h=document.getElementsByClassName("content-body")[0],ba=h.getElementsByClassName("template-board")[0],ca=h.getElementsByClassName("template-panel")[0],da=h.getElementsByClassName("template-task")[0],
ea=h.getElementsByClassName("template-sub-task")[0],fa=h.getElementsByClassName("template-timer")[0],ha=h.getElementsByClassName("template-timelog-panel")[0],ia=h.getElementsByClassName("template-timelog-session-day")[0],ja=h.getElementsByClassName("template-timelog-session-hour")[0];h.removeChild(ba);h.removeChild(ca);h.removeChild(da);h.removeChild(ea);h.removeChild(fa);h.removeChild(ha);h.removeChild(ia);h.removeChild(ja);var K=Object.freeze({task:"task",subTask:"sub-task"}),G=Object.freeze({timerSettingsId:"timerSettings",
modelSettingsId:"modelSettings"}),k=Object.freeze({taskStorageId:"task.json",timelogStorageId:"timelog.json",settingStorageId:"setting.json",boardStorageId:"board.json",panelStorageId:"panel.json"}),m=Object.freeze({OnAll:"all",OnEdit:"edit",OnRemove:"remove",OnAdd:"add"}),V=function(){var a=0,c=[],b=null,d=function(){ka.OverlayOn("Saving...");window.onbeforeunload=function(a){a.preventDefault();return""}},e=function(){return utils.parseQueryString(window.location.hash).access_token},f=function(a){null==
l&&(l={},l["task.json"]={data:{filename:"task.json",content:u}},l["timelog.json"]={data:{filename:"timelog.json",content:t}},l["setting.json"]={data:{filename:"setting.json",content:J}},l["board.json"]={data:{filename:"board.json",content:U}},l["panel.json"]={data:{filename:"panel.json",content:O}},q(0,function(b){n.ToggleSnack("Dropbox initialized!");a&&a(!0)}))},g=function(a,b,c){console.assert(a);console.assert(a instanceof Array);if(b<a.length){var d=a[b];h(a[b].name,function(e){e?(console.log(e),
null==l&&(l={}),l[e.filename]={data:e,meta:d},"task.json"===e.filename?u=e.content:"timelog.json"===e.filename?t=e.content:"setting.json"===e.filename?J=e.content:"board.json"===e.filename?U=e.content:"panel.json"===e.filename?O=e.content:console.assert(!1,"Never seen this file before!")):console.log("read failed! -> ",item.name);g(a,b+1,c)})}else c&&c(!0)},H=function(a,b){console.assert(a);var c=[],d=a.length;0<d?a.forEach(function(a){c.push(a);--d;0==d&&b&&b(c)}):b&&b(c)},L=function(a){b.filesListFolder({path:""}).then(function(b){H(b.entries,
function(b){console.assert(b);console.assert(b instanceof Array);for(var c=document.getElementById("files"),d=0;d<b.length;d++){var e=b[d].name,la=document.createElement("li");la.innerHTML=e;c.appendChild(la)}0===b.length?f(a):g(b,0,a)})})["catch"](function(b){console.error(b);a&&a(!1)})},h=function(a,b){var c='{"path": "/'+a+'"}';$.ajax({url:"https://content.dropboxapi.com/2/files/download",type:"POST",dataType:"json",headers:{Authorization:"Bearer "+e(),"Dropbox-API-Arg":c}}).done(function(a){b&&
b(a)}).fail(function(a){console.log("error",a);b&&b(null)})},y=function(a,c,d){console.assert(-1<Object.values(k).indexOf(a));var e="/"+a,f=JSON.stringify(c);b.filesUpload({path:e,contents:f,mode:"overwrite"}).then(function(a){console.log(a);d&&d(a)})["catch"](function(b){console.log(b);console.log("retrying.......");setTimeout(function(){y(a,c,d)},2E3)})},p=function(){var b=c.length;if(0<b)if(a!=b)a=b,setTimeout(p,2);else{var d=za(c);c=[];a=0;b=[];for(var e={i:0};e.i<d.length;e={i:e.i},e.i++){var f=
new Promise(function(a){return function(b){m(d[a.i],function(c){b({updated:d[a.i],result:c})})}}(e));b.push(f)}Promise.all(b).then(function(a){setTimeout(p,2);console.log("Remote storage update done!");ka.OverlayOff();window.onbeforeunload=null})}else setTimeout(p,2)},m=function(a,b){var c=!0;null==l?c=!1:Object.values(l).length!=Object.values(k).length&&(c=!1);1==c?y(a,l[a].data,function(c){l[a].meta=c;b&&b(!0)}):b&&b(!1)},q=function(a,b){var c=Object.values(k).sort(),d=c[a];a<c.length?(a+=1,m(d,
function(c){c?console.log("remote file updated successfully --\x3e",d):console.log("remote update failed --\x3e",d);q(a,b)})):b&&b()},v=function(a,c,d){var e=Object.values(k).sort(),f=e[a];a<e.length?b.filesGetMetadata({path:"/"+f}).then(function(b){(new Date(l[f].meta.server_modified)).valueOf()!=(new Date(b.server_modified)).valueOf()?g([b],0,function(b){b?(console.log("Sync with Remote Db ->",f),n.ToggleSnack("Sync with Remote Database"),c=!0):(console.log("Sync with Remote Db Failed! ->",f),n.ToggleSnack("Sync with Remote Failed!"));
v(a+1,c,d)}):v(a+1,c,d)})["catch"](function(b){console.log(b);console.log("retrying....");setTimeout(function(){v(a,c,d)},1E3)}):d&&d(c)};return{AuthenticateAndInitDb:function(a){if(e())document.getElementById("authed-section").style.display="block",b=new Dropbox.Dropbox({accessToken:e()}),L(function(b){b?(setTimeout(p,2),n.ToggleSnack("Local database updated!"),a&&a(!0)):(n.ToggleSnack("Local database update failed!"),a&&a(!1))});else{document.getElementById("pre-auth-section").style.display="block";
b=new Dropbox.Dropbox({clientId:"1xc4d9cf123830a"});var c=b.getAuthenticationUrl("https://produktiewe.github.io/");document.getElementById("authlink").href=c;a&&a(!1)}},QueueUpdateRemoteStorage:function(a){c.push(a);d()},UpdateChangedFiles:v}}(),E=function(){var a=null,c=null,b=null,d=null,e=null,f=0,g=function(a,b){b===m.OnEdit&&a.id===c.id&&I(a.timelog,D,0,function(b){console.log("timerstate updated");c=a;d=b;f=P(b)})},H=function(a){M(G.timerSettingsId,function(b){b||console.log("no timer settings found!");
a&&a(b)})},L=function(){if(a&&c&&b&&e&&d){var g=b.getElementsByClassName("timer-task-title")[0],v=b.getElementsByClassName("timer-task-session-time")[0],H=b.getElementsByClassName("timer-task-total-time")[0],h=Date.now(),k=a.startTimeStamp,p=T(k,h);h=N(f+(h-k));g.innerText=c.title;v.innerText=p.hour.toString()+":"+p.minute.toString()+":"+p.second.toString();H.innerText=h.hour.toString()+":"+h.minute.toString()+":"+h.second.toString();setTimeout(L,200)}},Aa=function(a,b,c){z(G.timerSettingsId,"taskId",
a,M,Q,function(a){a?(console.log("taskId added to app settings successfully"),z(G.timerSettingsId,"timeLogId",b,M,Q,function(a){a?(console.log("timeLogId added to app settings successfully"),c&&c(!0)):(console.log("timeLogId added to app settings failed!"),c&&c(!1))})):(console.log("taskId added to app settings failed!"),c&&c(!1))})},y=function(q,v){console.assert(q);console.assert(v);console.assert(null===a);console.assert(null===c);console.assert(null===d);console.assert(null===e);I(q.timelog,D,
0,function(e){b=Ba(q);a=v;c=q;d=e;f=P(e);n.ToggleSnack("Timer started - "+q.title);h.appendChild(b);setTimeout(L,200)});e=Ca(k.taskStorageId,m.OnAll,g)},p=function(){var b=Date.now();clearTimeout(L);n.ToggleSnack("Timer stopped for - "+c.title);z(a.id,"endTimeStamp",b,D,Da,function(a){a?(console.log("set endTimeStamp success!"),l(),A()):console.log("set endTimeStamp faield!")})},l=function(){z(G.timerSettingsId,"timeLogId",null,M,Q,function(a){a?console.log("timeLogId - cleaned sucess!"):console.log("timeLogId - cleaned failed!")});
z(G.timerSettingsId,"taskId",null,M,Q,function(a){a?console.log("taskId - cleaned sucess!"):console.log("taskId - cleaned failed!")});e&&(Ea(k.taskStorageId,e),e=null);b&&h.contains(b)&&h.removeChild(b);d=b=c=a=null;f=0};return{InitTimer:function(){b&&h.removeChild(b);H(function(a){a?a.taskId&&a.timeLogId?ma([a.taskId,a.timeLogId],[r,D],null,0,function(a){var b=a[0];a=a[1];b&&a?y(b,a):l()}):(a.taskId||a.timeLogId)&&l():console.log("error timerSettings not found!")})},StartTimer:function(a,b){a&&b&&
Aa(a.id,b.id,function(c){!0===c?y(a,b):n.ToggleSnack("Start Timer Failed")})},StopTimer:function(){p()},IsRunning:function(a){H(function(b){b?a&&a(b.timeLogId&&b.taskId):a&&a(!1)})}}}(),F=Object.freeze(function(){var a={};a[k.taskStorageId]=[];a[k.timelogStorageId]=[];a[k.settingStorageId]=[];a[k.boardStorageId]=[];a[k.panelStorageId]=[];return a}()),Ea=function(a,c){console.assert(F);console.assert(-1<Object.values(k).indexOf(a));var b=F[a];console.assert(b instanceof Array);for(var d=0;d<b.length;)c===
b[d].id?(b.splice(d,1),d=0):d+=1},Ca=function(a,c,b){console.assert(F);console.assert(-1<Object.values(k).indexOf(a));console.assert(-1<Object.values(m).indexOf(c));console.assert("function"===typeof b);var d=S();F[a].push({id:d,eventType:c,remoteStorageId:a,cb:b});return d},B=function(a,c,b){console.assert(F);console.assert(-1<Object.values(k).indexOf(a));console.assert(-1<Object.values(m).indexOf(c));V.QueueUpdateRemoteStorage(a);setTimeout(function(){console.assert(F);console.assert(-1<Object.values(k).indexOf(a));
console.assert(-1<Object.values(m).indexOf(c));var d=F[a];console.assert(d instanceof Array);for(var e=0;e<d.length;e++){var f=d[e];f.eventType!==c&&f.eventType!==m.OnAll||f.cb(b,c)}},2)},I=function(a,c,b,d,e){console.assert(Number.isInteger(b));console.assert(a instanceof Array);console.assert("function"===typeof c);e instanceof Array||(e=[]);b<a.length?c(a[b],function(f){e.push(f);b+=1;I(a,c,b,d,e)}):d&&d(e)},ma=function(a,c,b,d,e){console.assert(Number.isInteger(d));console.assert(a instanceof
Array);console.assert(c instanceof Array);console.assert(a.length==c.length);b instanceof Array||(b=[]);if(d<a.length)(0,c[d])(a[d],function(f){b.push(f);d+=1;ma(a,c,b,d,e)});else e(b)},na=function(a,c){console.assert(a instanceof Array);console.assert("function"===typeof c);for(var b=0;b<a.length;b++)c(a[b])},W=function(a,c,b,d,e,f){console.assert("string"===typeof c);console.assert("function"===typeof d);console.assert("function"===typeof e);d(a,function(a){if(a){console.assert(a[c]instanceof Array);
var d=a[c],g=d.indexOf(b);-1<g&&d.splice(g,1);e(a,function(a){f&&f(a)})}else f&&f(!1)})},X=function(a,c,b,d,e,f){console.assert("string"===typeof c);console.assert("function"===typeof d);console.assert("function"===typeof e);d(a,function(a){a?(console.assert(a[c]instanceof Array),a[c].push(b),e(a,function(a){f&&f(a)})):f&&f(!1)})},z=function(a,c,b,d,e,f){console.assert("string"===typeof c);console.assert("function"===typeof d);console.assert("function"===typeof e);d(a,function(a){a?(console.assert(c in
a),a[c]=b,e(a,function(a){f&&f(a)})):f&&f(!1)})},M=function(a,c){console.assert(-1<Object.values(G).indexOf(a));var b=x(J[a]);c&&c(b)},Q=function(a,c){J[a.id]=x(a);c&&c(!0);B(k.settingStorageId,m.OnEdit,J[a.id])},Fa=function(a,c){var b=x(U[a]);c&&c(b)},r=function(a,c){var b=x(u[a]);c&&c(b)},Y=function(a,c){r(a,function(b){b.type===K.task&&(na(b.timelog,oa),na(b.subtasks,Y));delete u[a];c&&c(!0);B(k.taskStorageId,m.OnRemove,!0)})},C=function(a,c){null===a.doneDate&&1==a.done?a.doneDate=Date.now():
(a.doneDate=null,a.done=!1);u[a.id]=x(a);c&&c(!0);B(k.taskStorageId,m.OnEdit,u[a.id])},Ga=function(a,c){pa(a,K.subTask,function(a){c&&c(a)})},Ha=function(a,c){pa(a,K.task,function(a){c&&c(a)})},pa=function(a,c,b){console.assert(-1<Object.values(K).indexOf(c));console.assert(a);var d=S();a={id:d,title:a,done:!1,doneDate:null,type:c,createdDate:Date.now(),timelog:[],subtasks:[]};c==K.subTask&&delete a.subtasks;u[d]=a;b&&b(u[d]);B(k.taskStorageId,m.OnAdd,u[d])},D=function(a,c){var b=x(t[a]);c&&c(b)},
oa=function(a,c){delete t[a];c&&c(!0);B(k.timelogStorageId,m.OnRemove,!0)},Da=function(a,c){var b=a.startTimeStamp,d=a.endTimeStamp;d&&b&&(a.duration=T(b,d));t[a.id]=x(a);c&&c(!0);B(k.timelogStorageId,m.OnEdit,t[a.id])},Ia=function(a,c,b){var d=S(),e=null;b&&(e=b);t[d]={id:d,startTimeStamp:a,endTimeStamp:e,duration:null};c&&c(t[d]);B(k.timelogStorageId,m.OnAdd,t[d])},Ja=function(a){var c={},b=[];a.sort(function(a,b){return b.startTimeStamp-a.startTimeStamp});for(var d=0;d<a.length;++d){var e=a[d],
f=(new Date(Date.now())).toDateString(),g=(new Date(e.startTimeStamp)).toDateString();f=g===f?"Today":g;f in c?c[f].push(e):(c[f]=[e],b.push({date:f,timeLogObjArr:c[f]}))}return b},Ka=function(a,c,b,d){var e="validated";if(b>c){for(d=0;d<a.length;++d){var f=a[d];if(f.startTimeStamp<b&&f.endTimeStamp>b||f.startTimeStamp<c&&f.endTimeStamp>c||c<f.endTimeStamp&&b>f.endTimeStamp||c<f.startTimeStamp&&b>f.startTimeStamp)e=new Date(f.endTimeStamp),e=(new Date(f.startTimeStamp)).toLocaleString()+" - "+e.toLocaleString()+
"\n"}"validated"!=e&&(e="Conflict with: "+e)}else e="End time must be greater than start time.";return e},P=function(a){console.assert(a instanceof Array);for(var c=0,b=0;b<a.length;b++){var d=a[b],e=d.startTimeStamp;d=d.endTimeStamp;null!=d&&(e=d-e,console.assert(0<=e),c+=e)}return c},qa=function(a,c){O[a.id]=a;c&&c(!0);B(k.panelStorageId,m.OnEdit,!0)},Z=function(a,c){var b=x(O[a]);c&&c(b)},ra=function(a,c,b,d){Ia(a,function(a){a?(console.log("timelog creation success"),X(b,"timelog",a.id,r,C,function(b){b?
(console.log("timelog added to task successfully!"),d&&d(a)):(console.log("timelog added to task failed!"),d&&d(null))})):(console.log("timelog creation failed!"),d&&d(null))},c)},La=function(a){var c=a.taskObj.id;W(a.panelId,"tasks",c,Z,qa,function(a){a?(console.log("edit panel success"),Y(c,function(a){a?console.log("task remove success!"):console.log("task remove failed!");A()})):(console.log("edit panel failed"),A())})},ta=function(a){var c=a.taskObj.id,b=a.htmlRef.inpSubTasktitle.value,d=a.htmlRef.taskNode.getElementsByClassName("list-sub-tasks")[0];
b&&""!=b&&Ga(b,function(b){b?X(c,"subtasks",b.id,r,C,function(e){e?(e=sa(b,c),d.appendChild(e),a.htmlRef.inpSubTasktitle.value="",console.log("edit task to add subtask success")):console.log("edit task to add subtask failed!")}):console.log("add subtask failed")})},ua=function(a){var c=a.taskObj;a=a.htmlRef.inpTaskTitle;c.title!=a.value&&""!=a.value&&z(c.id,"title",a.value,r,C,function(a){a?console.log("edit task title success!"):console.log("edit task title failed!")});""==a.value&&(a.value=c.title);
a.disabled=!0},Ma=function(a){var c=a.taskObj.title,b=a.htmlRef.inpTaskDoneChkbox.checked;z(a.taskObj.id,"done",b,r,C,function(a){a?(!0===b&&n.ToggleSnack("Task done - ",c+" at ",(new Date(Date.now())).toLocaleTimeString()),console.log("checked task success!")):console.log("checked task failed!")})},Na=function(a){var c=a.id;E.IsRunning(function(b){b?(console.log("A timer is already running."),n.ToggleSnack("A timer is already running.")):(b=Date.now(),ra(b,null,c,function(b){b?E.StartTimer(a,b):
console.assert(!1)}))})},aa=function(a){r(a.taskObj.id,function(a){a&&E.IsRunning(function(b){b?n.ToggleSnack("This action is not allowed while timer is still running."):(b=Oa(a),va.InitModal("Task: "+a.title,b),va.ShowModal())})})},Pa=function(a){var c=a.subTaskObj.id;W(a.taskId,"subtasks",c,r,C,function(a){a?(console.log("edit task successful!"),Y(c,function(a){a?console.log("remove subtask successful!"):console.log("remove subtask failed!");A()})):(A(),console.log("edit task failed!"))})},Qa=function(a){var c=
a.htmlRef.inpSubtaskDoneCheck.checked;r(a.subTaskObj.id,function(a){a.done=c;C(a,function(a){a?console.log("checked subtask success!"):console.log("checked subtask failed!")})})},wa=function(a){var c=a.subTaskObj;a=a.htmlRef.inpSubtaskTitle;c.title!=a.value&&""!=a.value&&z(c.id,"title",a.value,r,C,function(a){a?console.log("edit sub task title success!"):console.log("edit sub task failed!")});""==a.value&&(a.value=c.title);a.disabled=!0},ya=function(a){var c=a.htmlRef.inpAddTask.value,b=a.htmlRef.panelNode.getElementsByClassName("list-tasks")[0],
d=a.panelObj.id;""!=c&&null!=c&&Ha(c,function(c){console.assert(c);X(d,"tasks",c.id,Z,qa,function(e){e?(e=xa(c,d),b.appendChild(e),a.htmlRef.inpAddTask.value="",console.log("add task successful!")):console.log("add task failed!")})})},Ra=function(a){var c=a.taskObj,b=a.htmlRef.fromTimePicker,d=a.htmlRef.toTimePicker,e=a.htmlRef.datePicker.value.split("-");b=b.value.split(":");d=d.value.split(":");var f=new Date;f.setYear(e[0]);f.setMonth(e[1]-1);f.setDate(e[2]);f.setHours(b[0]);f.setMinutes(b[1]);
b[2]&&f.setSeconds(b[2]);f=f.valueOf();var g=new Date;g.setYear(e[0]);g.setMonth(e[1]-1);g.setDate(e[2]);g.setHours(d[0]);g.setMinutes(d[1]);d[2]&&g.setSeconds(d[2]);g=g.valueOf();I(c.timelog,D,0,function(b){b?(b=Ka(b,f,g),"validated"===b?ra(f,g,c.id,function(b){b&&(A(),aa(a))}):alert(b)):console.log("Add new timelog failed!")})},Sa=function(a){var c=a.timeLogObj,b=a.taskObj;oa(c.id,function(d){d?(console.log("timelog remove success!"),W(b.id,"timelog",c.id,r,C,function(b){b?(console.log("timelog id removed from task success!"),
A(),aa(a)):console.assert(!1)})):console.log("timelog remove failed!")})},Va=function(a,c){var b=null;Fa(a,function(d){if(d){b=Ta(d);for(var e=0;e<d.panels.length;e++)Ua(d.panels[e],a,function(a){a?b.appendChild(a):console.assert(!1)})}c&&c(b)})},Ua=function(a,c,b){var d=null,e=null;Z(a,function(f){if(f){d=Wa(f,c);e=d.getElementsByClassName("list-tasks")[0];for(var g=0;g<f.tasks.length;g++)Xa(f.tasks[g],a,function(a){a?e.appendChild(a):console.assert(!1)})}b&&b(d)})},Xa=function(a,c,b){var d=null,
e=null;r(a,function(f){if(f){d=xa(f,c);e=d.getElementsByClassName("list-sub-tasks")[0];for(var g=0;g<f.subtasks.length;g++)Ya(f.subtasks[g],a,function(a){a?e.appendChild(a):console.assert(!1)})}b&&b(d)})},Ya=function(a,c,b){var d=null;r(a,function(a){a&&(d=sa(a,c));b&&b(d)})},Ta=function(a){var c=ba.cloneNode(!0),b=c.getElementsByClassName("title-board")[0],d=c.getElementsByClassName("btn-add-panel")[0];c.getElementsByClassName("input-add-panel");b.innerText=a.title;d.addEventListener("click",function(a){});
return c},Wa=function(a,c){var b=ca.cloneNode(!0),d=b.getElementsByClassName("title-panel")[0],e=b.getElementsByClassName("btn-add-task")[0],f=b.getElementsByClassName("input-add-task")[0],g=b.getElementsByClassName("btn-remove-panel")[0];d.innerText=a.title;var h={panelObj:a,boardId:c,htmlRef:{panelNode:b,title:d,inpAddTask:f,btnRemovePanel:g}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===f&&ya(h)});e.addEventListener("click",function(a){ya(h)});g.addEventListener("click",
function(a){});return b},xa=function(a,c){var b=da.cloneNode(!0),d=b.getElementsByClassName("btn-move-task")[0],e=b.getElementsByClassName("btn-remove-task")[0],f=b.getElementsByClassName("btn-add-subtask")[0],g=b.getElementsByClassName("btn-start-timer")[0],h=b.getElementsByClassName("btn-open-timelog")[0],k=b.getElementsByClassName("input-task-checkbox-done")[0],l=b.getElementsByClassName("input-task-title")[0],y=b.getElementsByClassName("input-subtask-title")[0],p=b.getElementsByClassName("span-total-time")[0],
m=b.getElementsByClassName("span-on-going-timer")[0];l.value=a.title;k.checked=a.done;I(a.timelog,D,0,function(a){a&&(a=P(a),a=N(a),p.innerText=a.hour+"hr "+a.minute+"m")});var q={taskObj:a,panelId:c,htmlRef:{taskNode:b,btnMoveTask:d,btnRemoveTask:e,btnAddSubTask:f,btnStartTimer:g,btnAddCustomTime:h,inpTaskDoneChkbox:k,inpTaskTitle:l,inpSubTasktitle:y,sTotalTime:p,sOnGoingTime:m}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===y&&ta(q);13===event.keyCode&&
document.activeElement===l&&ua(q)});document.addEventListener("click",function(a){event.target===l?l.disabled=!1:(l.disabled=!0,ua(q))});d.addEventListener("click",function(a){});e.addEventListener("click",function(a){E.IsRunning(function(a){a?n.ToggleSnack("This action is not allowed while timer is still running."):confirm("Are you sure you want to remove this task?")&&La(q)})});f.addEventListener("click",function(a){ta(q)});g.addEventListener("click",function(b){Na(a)});h.addEventListener("click",
function(a){aa(q)});k.addEventListener("click",function(a){Ma(q)});return b},sa=function(a,c){var b=ea.cloneNode(!0),d=b.getElementsByClassName("btn-remove-subtask")[0],e=b.getElementsByClassName("input-subtask-checkbox-done")[0],f=b.getElementsByClassName("input-subtask-title")[0];f.value=a.title;e.checked=a.done;var g={subTaskObj:a,taskId:c,htmlRef:{subTaskNode:b,btnRemoveSubtask:d,inpSubtaskDoneCheck:e,inpSubtaskTitle:f}};document.addEventListener("keypress",function(a){13===event.keyCode&&document.activeElement===
f&&wa(g)});document.addEventListener("click",function(a){event.target===f?f.disabled=!1:(f.disabled=!0,wa(g))});d.addEventListener("click",function(a){E.IsRunning(function(a){a?n.ToggleSnack("This action is not allowed while timer is still running."):confirm("Are you sure you want to remove this sub-task?")&&Pa(g)})});e.addEventListener("click",function(a){Qa(g)});return b},Ba=function(a){a=fa.cloneNode(!0);a.getElementsByClassName("timer-task-title");a.getElementsByClassName("timer-task-session-time");
a.getElementsByClassName("timer-task-total-time");a.getElementsByClassName("btn-stop-timer")[0].addEventListener("click",function(a){E.StopTimer()});return a},Oa=function(a){var c=ha.cloneNode(!0),b=c.getElementsByClassName("list-day")[0],d=c.getElementsByClassName("btn-add-entry")[0],e=c.getElementsByClassName("date-picker")[0],f=c.getElementsByClassName("time-picker-from")[0],g=c.getElementsByClassName("time-picker-to")[0],h=c.getElementsByClassName("duration-display")[0],k=(new Date(Date.now())).toLocaleDateString().split("/");
k=k[2]+"-"+w(k[0])+"-"+w(k[1]);e.value=k;f.value="08:00:00";g.value="23:00:00";I(a.timelog,D,0,function(c){c=Ja(c);for(var d=0;d<c.length;++d){var e=a,f=c[d].date,g=c[d].timeLogObjArr,h=ia.cloneNode(!0),k=h.getElementsByClassName("list-hour")[0],l=h.getElementsByClassName("date")[0],m=h.getElementsByClassName("day-duration")[0],n=P(g);n=N(n);l.innerText=f;m.innerText=n.hour.toString()+"h "+n.minute.toString()+"m";for(f=0;f<g.length;f++)l=Za(e,g[f]),k.appendChild(l);b.appendChild(h)}});var l={taskObj:a,
htmlRef:{panelNode:c,dayList:b,addTimeLog:d,datePicker:e,fromTimePicker:f,toTimePicker:g,durationDisplay:h}};d.addEventListener("click",function(a){Ra(l)});return c},Za=function(a,c){var b=ja.cloneNode(!0),d=b.getElementsByClassName("time-picker-from")[0],e=b.getElementsByClassName("time-picker-to")[0],f=b.getElementsByClassName("duration")[0],g=b.getElementsByClassName("range")[0],h=b.getElementsByClassName("btn-edit-session")[0],k=b.getElementsByClassName("btn-remove-session")[0],l=T(c.startTimeStamp,
c.endTimeStamp),m=new Date(c.startTimeStamp),p=new Date(c.endTimeStamp);g.innerText=m.toLocaleTimeString()+" - "+p.toLocaleTimeString();f.innerText=l.hour+"hr "+l.minute+"m "+l.second+"s";l=w(m.getHours())+":"+w(m.getMinutes())+":"+w(m.getSeconds());p=w(p.getHours())+":"+w(p.getMinutes())+":"+w(p.getSeconds());d.value=l;e.value=p;var n={taskObj:a,timeLogObj:c,htmlRef:{sessionHourNode:b,fromTimePicker:d,toTimePicker:e,durationTitle:f,rangeTitle:g,btnEditSession:h,btnRemoveSession:k}};d.addEventListener("change",
function(a){});h.addEventListener("click",function(a){confirm("Are you sure you want to modify this session?")});k.addEventListener("click",function(a){confirm("Are you sure you want to remove this session?")&&Sa(n)});return b},A=function(){R&&R.remove();Va($a,function(a){R=a;h.appendChild(R)});E.InitTimer()},va=function(){var a=document.getElementById("global-modal"),c=a.getElementsByClassName("modal-body")[0],b=a.getElementsByClassName("modal-title")[0];return{InitModal:function(a,e){b.innerText=
a;c.innerHTML="";c.appendChild(e)},ToggleModal:function(){$("#global-modal").modal("toggle")},HideModal:function(){$("#global-modal").modal("hide")},ShowModal:function(){$("#global-modal").modal("show")}}}(),n=function(){var a=document.getElementById("snackbar"),c=[],b=!1,d=function(){a.className=a.className.replace("show","");b=!1;0<c.length&&(a.innerText=c.shift(),a.className="show",setTimeout(d,2E3),b=!0)};return{ToggleSnack:function(a){c.push(a);!1===b&&setTimeout(d,1)}}}(),ka=function(){var a=
document.getElementById("overlay"),c=a.getElementsByClassName("overlay-text")[0];return{OverlayOn:function(b){c.innerText=b;a.style.display="block"},OverlayOff:function(){a.style.display="none"}}}(),$a=1,R=null;V.AuthenticateAndInitDb(function(a){A()});window.addEventListener("focus",function(){h.style.display="none";V.UpdateChangedFiles(0,!1,function(a){!0===a?window.location.reload(!0):(h.style.display="block",n.ToggleSnack("Synced with Remote Server"))})})});